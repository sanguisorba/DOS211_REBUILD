Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-1
                                                            

       1                                TITLE   CHKDSK - MS-DOS Disk consistanc
					y checker 
       2                                 
       3                                ; CHKDSK        Version 2.30 
       4                                ; Verifies and repairs MS-DOS disk dire
					ctory. 
       5                                 
       6                                 
       7                                ; To build CHKDSK you need three module
					s: 
       8                                ; CHKDSK CHKPROC CHKMES 
       9                                ; They should be linked the that order 
					as well. 
      10                                 
      11                                 
      12                                ; REVISION HISTORY 
      13                                 
      14                                ;REV 1.1 
      15                                ;     05/21/82  Added rev number 
      16                                 
      17                                ;REV 1.5 
      18                                ;       Mod by NANCYP to report on exte
					nts 
      19                                ;       Mod by AARONR to report volume 
					ID 
      20                                 
      21                                ;REV 2.0 
      22                                ;       Total rewrite for directories 
      23                                 
      24                                ;REV 2.1 
      25                                ;       Added ^C and INT 24H handlers 
      26                                 
      27                                ;REV 2.2 
      28                                ;       INTERNATIONAL support 
      29                                 
      30                                ;REV 2.3 
      31                                ;       Split into two modules to allow
					 assembly on a PC 
      32                                ;       CHKDSK and CHKPROC 
      33                                 
      34 = 0000                         FALSE   EQU     0 
      35 = FFFF                         TRUE    EQU     NOT FALSE 
      36                                 
      37 = 003A                         DRVCHAR EQU     ":" 
      38                                 
      39                                ;The following defines the ranges of DO
					S version numbers for which this CHKDSK
					 
      40                                ; is good 
      41                                 
      42 = 0136                         DOSVER_LOW EQU  0136H   ;1.54 in hex 
      43 = 020B                         DOSVER_HIGH EQU 020BH   ;2.11 in hex 
      44                                 
      45                                 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-2
                                                            

      46                             C          INCLUDE DOSSYM.ASM 
      47                             C  include DOSMAC.ASM 
      48                             C  ; 
      49                             C  ; Macro file for MSDOS. 
      50                             C  ; 
      51                             C   
      52                             C  SUBTTL BREAK a listing into pages and g
					ive new subtitles 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-3
BREAK a listing into pages and give new subtitles           

      53                             C  PAGE 
      54                             C  BREAK MACRO subtitle 
      55                             C   SUBTTL subtitle 
      56                             C   PAGE 
      57                             C  ENDM 
      58                             C   
      59                             C  BREAK <I_NEED: declare a variable exter
					nal, if necessary, and allocate a size>
					 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-4
I_NEED: declare a variable external, if necessary, and alloc

      60                             C   
      61                             C  ; 
      62                             C  ; declare a variable external and alloc
					ate a size 
      63                             C  ; 
      64                             C  I_NEED MACRO sym,len 
      65                             C   DATA SEGMENT BYTE PUBLIC 'DATA' 
      66                             C   IFIDN <len>,<WORD> 
      67                             C   EXTRN &sym:WORD 
      68                             C   ELSE 
      69                             C   IFIDN <len>,<DWORD> 
      70                             C   EXTRN &sym:DWORD 
      71                             C   ELSE 
      72                             C   EXTRN &sym:BYTE 
      73                             C   ENDIF 
      74                             C   ENDIF 
      75                             C   DATA ENDS 
      76                             C  ENDM 
      77                             C   
      78                             C  ; 
      79                             C  ; call a procedure that may be external
					. The call will be short. 
      80                             C  ; 
      81                             C  invoke MACRO name 
      82                             C  .xcref 
      83                             C   IF2 
      84                             C   IFNDEF name 
      85                             C   EXTRN name:NEAR 
      86                             C   ENDIF 
      87                             C   ENDIF 
      88                             C  .cref 
      89                             C   CALL name 
      90                             C  ENDM 
      91                             C   
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-5
I_NEED: declare a variable external, if necessary, and alloc

      92                             C  PAGE 
      93                             C  ; 
      94                             C  ; jump to a label that may be external.
					 The jump will be near. 
      95                             C  ; 
      96                             C  transfer MACRO name 
      97                             C  .xcref 
      98                             C   IF2 
      99                             C   IFNDEF name 
     100                             C   EXTRN name:NEAR 
     101                             C   ENDIF 
     102                             C   ENDIF 
     103                             C  .cref 
     104                             C   JUMP name 
     105                             C  ENDM 
     106                             C   
     107                             C  ; 
     108                             C  ; get a short address in a word 
     109                             C  ; 
     110                             C  short_addr MACRO name 
     111                             C   IFDIF <name>,<?> 
     112                             C  .xcref 
     113                             C   IF2 
     114                             C   IFNDEF name 
     115                             C   EXTRN name:NEAR 
     116                             C   ENDIF 
     117                             C   ENDIF 
     118                             C  .cref 
     119                             C   DW OFFSET DOSGROUP:name 
     120                             C   ELSE 
     121                             C   DW ? 
     122                             C   ENDIF 
     123                             C  ENDM 
     124                             C   
     125                             C  ; 
     126                             C  ; get a long address in a dword 
     127                             C  ; 
     128                             C  long_addr MACRO name 
     129                             C  .xcref 
     130                             C   IF2 
     131                             C   IFNDEF name 
     132                             C   EXTRN name:NEAR 
     133                             C   ENDIF 
     134                             C  .cref 
     135                             C   DD name 
     136                             C  ENDM 
     137                             C   
     138                             C  ; 
     139                             C  ; declare a PROC near or far but PUBLIC
					 nonetheless 
     140                             C  ; 
     141                             C  procedure MACRO name,distance 
     142                             C   PUBLIC name 
     143                             C  name PROC distance 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-6
I_NEED: declare a variable external, if necessary, and alloc

     144                             C  ENDM 
     145                             C   
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-7
I_NEED: declare a variable external, if necessary, and alloc

     146                             C  PAGE 
     147                             C  ; 
     148                             C  ; define a data item to be public and o
					f an appropriate size/type 
     149                             C  ; 
     150                             C  I_AM MACRO name,size 
     151                             C   PUBLIC name 
     152                             C   
     153                             C   IFIDN <size>,<WORD> 
     154                             C  name DW ? 
     155                             C   ELSE 
     156                             C   IFIDN <size>,<DWORD> 
     157                             C  name DD ? 
     158                             C   ELSE 
     159                             C   IFIDN <size>,<BYTE> 
     160                             C  name DB ? 
     161                             C   ELSE 
     162                             C  name DB size DUP (?) 
     163                             C   ENDIF 
     164                             C   ENDIF 
     165                             C   ENDIF 
     166                             C  ENDM 
     167                             C   
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-8
I_NEED: declare a variable external, if necessary, and alloc

     168                             C  PAGE 
     169                             C  ; 
     170                             C  ; call the macro chain 
     171                             C  ; 
     172                             C  do_ext macro 
     173                             C  endm 
     174                             C   
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-9
I_NEED: declare a variable external, if necessary, and alloc

     175                             C  PAGE 
     176                             C   
     177                             C  ; 
     178                             C  ; define an entry in a procedure 
     179                             C  ; 
     180                             C  entry macro name 
     181                             C   PUBLIC name 
     182                             C  name: 
     183                             C  endm 
     184                             C   
     185                             C  BREAK <ERROR - print a message and then
					 jump to a label> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-10
ERROR - print a message and then jump to a label            

     186                             C   
     187                             C  error macro code 
     188                             C   local a 
     189                             C  .xcref 
     190                             C   MOV AL,code 
     191                             C   transfer SYS_RET_ERR 
     192                             C  .cref 
     193                             C  ENDM 
     194                             C   
     195                             C  BREAK <JUMP - real jump that links up s
					hortwise> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-11
JUMP - real jump that links up shortwise                    

     196                             C  ; 
     197                             C  ; given a label <lbl> either 2 byte jum
					p to another label <lbl>_J 
     198                             C  ; if it is near enough or 3 byte jump t
					o <lbl> 
     199                             C  ; 
     200                             C   
     201                             C  jump macro lbl 
     202                             C   local a 
     203                             C  .xcref 
     204                             C   a: 
     205                             C   ifndef lbl&_J ;; is this the first inv
					ocation 
     206                             C   JMP lbl 
     207                             C   ELSE 
     208                             C   IF lbl&_J GE $ 
     209                             C   JMP lbl 
     210                             C   ELSE 
     211                             C   IF ($-lbl&_J) GT 126 ;; is the jump to
					o far away? 
     212                             C   JMP lbl 
     213                             C   ELSE ;; do the short one... 
     214                             C   JMP lbl&_J 
     215                             C   ENDIF 
     216                             C   ENDIF 
     217                             C   ENDIF 
     218                             C   lbl&_j = a 
     219                             C  .cref 
     220                             C  endm 
     221                             C   
     222                             C  BREAK <RETURN - return from a function>
					 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-12
RETURN - return from a function                             

     223                             C   
     224                             C  return macro 
     225                             C   local a 
     226                             C  .xcref 
     227                             C  a: 
     228                             C   RET 
     229                             C  ret_l = a 
     230                             C  .cref 
     231                             C  endm 
     232                             C   
     233                             C  BREAK <CONDRET - conditional return> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-13
CONDRET - conditional return                                

     234                             C   
     235                             C  makelab macro l,cc,ncc 
     236                             C   local a 
     237                             C   j&ncc a ;; j<NCC> a: 
     238                             C   return ;; return 
     239                             C   a: ;; a: 
     240                             C   ret_&cc = ret_l ;; define ret_<CC> to 
					be ret_l 
     241                             C  endm 
     242                             C   
     243                             C  condret macro cc,ncc 
     244                             C   local a,b 
     245                             C   ifdef ret_l ;; if ret_l is defined 
     246                             C   if (($ - ret_l) le 126) and ($ gt ret_
					l) 
     247                             C   ;; if ret_l is near enough then 
     248                             C   a: j&cc ret_l ;; a: j<CC> to ret_l 
     249                             C   ret_&cc = a ;; define ret_<CC> to be a
					: 
     250                             C   else 
     251                             C   makelab a,cc,ncc 
     252                             C   endif 
     253                             C   else 
     254                             C   ifdef ret_&cc ;; if ret_<CC> defined 
     255                             C   if (($ - ret_&cc) le 126) and ($ gt re
					t_&cc) 
     256                             C   ;; if ret_<CC> is near enough 
     257                             C   a: j&cc ret_&cc ;; a: j<CC> to ret_<CC
					> 
     258                             C   ret_&cc = a ;; define ret_<CC> to be a
					: 
     259                             C   else 
     260                             C   makelab a,cc,ncc 
     261                             C   endif 
     262                             C   else 
     263                             C   makelab a,cc,ncc 
     264                             C   endif 
     265                             C   endif 
     266                             C  endm 
     267                             C  ;condret macro cc,ncc 
     268                             C  ; local a,b 
     269                             C  ; ifdef ret_l ; if ret_l is defined 
     270                             C  ; if (($ - ret_l) le 126) and ($ gt ret
					_l) 
     271                             C  ; ; if ret_l is near enough then 
     272                             C  ; a: j&cc ret_l ; a: j<CC> to ret_l 
     273                             C  ; ret_&cc = a ; define ret_<CC> to be a
					: 
     274                             C  ; exitm 
     275                             C  ; endif 
     276                             C  ; endif 
     277                             C  ; ifdef ret_&cc ; if ret_<CC> defined 
     278                             C  ; if (($ - ret_&cc) le 126) and ($ gt r
					et_&cc) 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-14
CONDRET - conditional return                                

     279                             C  ; ; if ret_<CC> is near enough 
     280                             C  ; a: j&cc ret_&cc ; a: j<CC> to ret_<CC
					> 
     281                             C  ; ret_&cc = a ; define ret_<CC> to be a
					: 
     282                             C  ; exitm 
     283                             C  ; endif 
     284                             C  ; endif 
     285                             C  ; j&ncc a ; j<NCC> a: 
     286                             C  ; return ; return 
     287                             C  ; a: ; a: 
     288                             C  ; ret_&cc = ret_l ; define ret_<CC> to 
					be ret_l 
     289                             C  ;endm 
     290                             C  ; 
     291                             C  BREAK <RETZ - return if zero, links up 
					shortwise if necessary> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-15
RETZ - return if zero, links up shortwise if necessary      

     292                             C   
     293                             C  retz macro 
     294                             C   condret z,nz 
     295                             C  endm 
     296                             C   
     297                             C  BREAK <RETNZ - return if not zero, link
					s up shortwise if necessary> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-16
RETNZ - return if not zero, links up shortwise if necessary 

     298                             C   
     299                             C  retnz macro 
     300                             C   condret nz,z 
     301                             C  endm 
     302                             C   
     303                             C  BREAK <RETC - return if carry set, link
					s up shortwise if necessary> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-17
RETC - return if carry set, links up shortwise if necessary 

     304                             C   
     305                             C  retc macro 
     306                             C   condret c,nc 
     307                             C  endm 
     308                             C   
     309                             C  BREAK <RETNC - return if not carry, lin
					ks up shortwise if necessary> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-18
RETNC - return if not carry, links up shortwise if necessary

     310                             C   
     311                             C  retnc macro 
     312                             C   condret nc,c 
     313                             C  endm 
     314                             C   
     315                             C  BREAK <CONTEXT - set the DOS context to
					 a particular register> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-19
CONTEXT - set the DOS context to a particular register      

     316                             C   
     317                             C  context macro r 
     318                             C   PUSH SS 
     319                             C   POP r 
     320                             C   ASSUME r:DOSGROUP 
     321                             C  endm 
     322                             C   
     323                             C  IF2 
     324                             C      %OUT    DOSSYM in Pass 2 
     325                             C  ENDIF 
     326                             C   
     327                             C  ENDIF 
     328                             C   
     329 = 0002                      C  DOS_MAJOR_VERSION   EQU      2 
     330 = 000B                      C  DOS_MINOR_VERSION   EQU     11 
     331                             C   
     332                             C  BREAK <Control character definitions> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-20
Control character definitions                               

     333                             C   
     334 = 007F                      C  c_DEL       EQU     7Fh         ;    AS
					CII rubout or delete previous char 
     335 = 0008                      C  c_BS        EQU     08h         ; ^H AS
					CII backspace 
     336 = 000D                      C  c_CR        EQU     0Dh         ; ^M AS
					CII carriage return 
     337 = 000A                      C  c_LF        EQU     0Ah         ; ^J AS
					CII linefeed 
     338 = 0017                      C  c_ETB       EQU     17h         ; ^W AS
					CII end of transmission 
     339 = 0015                      C  c_NAK       EQU     15h         ; ^U AS
					CII negative acknowledge 
     340 = 0003                      C  c_ETX       EQU     03h         ; ^C AS
					CII end of text 
     341 = 0009                      C  c_HT        EQU     09h         ; ^I AS
					CII tab 
     342                             C   
     343                             C  BREAK <BPB Definition> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-21
BPB Definition                                              

     344                             C   
     345                             C   
     346                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     347                             C  ;                                      
					                                    ; 
     348                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     349                             C  ;                                      
					                                    ; 
     350                             C  ; Certain structures, constants and sys
					tem  calls  below  are  private  to ; 
     351                             C  ; the DOS  and  are  extremely  version
					-dependent.  They may change at any ; 
     352                             C  ; time at  the  implementors'  whim.   
					As  a  result,  they  must  not  be ; 
     353                             C  ; documented to  the  general  public. 
					  If  an  extreme case arises, they ; 
     354                             C  ; must be documented with this warning.
					                                    ; 
     355                             C  ;                                      
					                                    ; 
     356                             C  ; Those structures and constants that a
					re subject to  the  above  will  be ; 
     357                             C  ; marked and bracketed with the flag:  
					                                    ; 
     358                             C  ;                                      
					                                    ; 
     359                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     360                             C  ;                                      
					                                    ; 
     361                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     362                             C   
     363                             C  BREAK  <Bios Parameter Block> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-22
Bios Parameter Block                                        

     364                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     365                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     366                             C  ;                                      
					                                    ; 
     367                             C   
     368                             C  ; Bios Parameter Block definition 
     369                             C  ; This structure is used to build a ful
					l DPB 
     370                             C   
     371                             C  BPBLOCK STRUC 
     372 0000  ????                  C  BPSECSZ DW      ?       ; Size in bytes
					 of physical sector 
     373 0002  ??                    C  BPCLUS  DB      ?       ; Sectors/Alloc
					 unit 
     374 0003  ????                  C  BPRES   DW      ?       ; Number of res
					erved sectors 
     375 0005  ??                    C  BPFTCNT DB      ?       ; Number of FAT
					s 
     376 0006  ????                  C  BPDRCNT DW      ?       ; Number of dir
					ectory entries 
     377 0008  ????                  C  BPSCCNT DW      ?       ; Total number 
					of sectors 
     378 000A  ??                    C  BPMEDIA DB      ?       ; Media descrip
					tor byte 
     379 000B  ????                  C  BPFTSEC DW      ?       ; Number of sec
					tors taken up by one FAT 
     380 000D                        C  BPBLOCK ENDS 
     381                             C  ;                                      
					                                    ; 
     382                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     383                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     384                             C   
     385                             C  BREAK <Disk I/O Buffer Header> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-23
Disk I/O Buffer Header                                      

     386                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     387                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     388                             C  ;                                      
					                                    ; 
     389                             C   
     390                             C  ; Field definition for I/O buffer infor
					mation 
     391                             C   
     392                             C  BUFFINFO        STRUC 
     393 0000  ????????              C  NEXTBUF         DD      ?       ; Point
					er to next buffer in list 
     394                             C  ; The next two items are often refed as
					 a word 
     395 0004  ??                    C  BUFDRV          DB      ?       ; Logic
					al drive # assoc with buffer FF = free 
     396 0005  ??                    C  BUFDIRTY        DB      ?       ; Dirty
					 flag 
     397 0006  ??                    C  BUFPRI          DB      ?       ; Buffe
					r selection priority (see EQUs below) 
     398 0007  ??                    C  VISIT           DB      ?       ; Visit
					 flag for buffer pool scans 
     399 0008  ????                  C  BUFSECNO        DW      ?       ; Secto
					r number of buffer 
     400                             C  ; The next two items are often refed as
					 a word 
     401 000A  ??                    C  BUFWRTCNT       DB      ?       ; For F
					AT sectors, # times sector written out 
     402 000B  ??                    C  BUFWRTINC       DB      ?       ; "   "
					     "   , # sectors between each write
					 
     403 000C  ????????              C  BUFDRVDP        DD      ?       ; Point
					er to drive parameters 
     404 0010                        C  BUFFINFO        ENDS 
     405                             C   
     406 = 0010                      C  BUFINSIZ        EQU     SIZE BUFFINFO 
     407                             C                                  ; Size 
					of structure in bytes 
     408                             C   
     409 = 0000                      C  FREEPRI EQU     0 
     410 = 0002                      C  LBRPRI  EQU     2               ; Last 
					byte of buffer read 
     411 = 0004                      C  LBWPRI  EQU     4               ; Last 
					byte written 
     412 = 0006                      C  RPRI    EQU     6               ; Read 
					but not last byte 
     413 = 0008                      C  WPRI    EQU     8               ; Writt
					en but not last byte 
     414 = 000F                      C  DIRPRI  EQU     15              ; Direc
					tory Sector 
     415 = 001E                      C  FATPRI  EQU     30              ; FAT s
					ector 
     416                             C  ;                                      
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-24
Disk I/O Buffer Header                                      

					                                    ; 
     417                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     418                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     419                             C   
     420                             C  BREAK <User stack inside of system call
					> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-25
User stack inside of system call                            

     421                             C  ; Location of user registers relative u
					ser stack pointer 
     422                             C   
     423                             C  user_environ    STRUC 
     424 0000  ????                  C  user_AX     DW      ? 
     425 0002  ????                  C  user_BX     DW      ? 
     426 0004  ????                  C  user_CX     DW      ? 
     427 0006  ????                  C  user_DX     DW      ? 
     428 0008  ????                  C  user_SI     DW      ? 
     429 000A  ????                  C  user_DI     DW      ? 
     430 000C  ????                  C  user_BP     DW      ? 
     431 000E  ????                  C  user_DS     DW      ? 
     432 0010  ????                  C  user_ES     DW      ? 
     433 0012  ????                  C  user_IP     DW      ? 
     434 0014  ????                  C  user_CS     DW      ? 
     435 0016  ????                  C  user_F      DW      ? 
     436 0018                        C  user_environ    ENDS 
     437                             C   
     438                             C  BREAK <interrupt definitions> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-26
interrupt definitions                                       

     439                             C   
     440 = 0020                      C  INTTAB          EQU     20H 
     441 = 0080                      C  INTBASE         EQU     4 * inttab 
     442 = 00C0                      C  ENTRYPOINT      EQU     INTBASE+40H 
     443                             C   
     444                             C          ENDIF 
     445                             C   
     446                             C  ; 
     447                             C  ; interrupt assignments 
     448                             C  ; 
     449                             C          IF      NOT ALTVECT 
     450 =                           C  int_abort           EQU     INTTAB     
					     ; abort process 
     451 = 0021                      C  int_command         EQU     int_abort+1
					     ; call MSDOS 
     452 = 0022                      C  int_terminate       EQU     int_abort+2
					     ; int to terminate address 
     453 = 0023                      C  int_ctrl_c          EQU     int_abort+3
					     ; ^c trapper 
     454 = 0024                      C  int_fatal_abort     EQU     int_abort+4
					     ; hard disk error 
     455 = 0025                      C  int_disk_read       EQU     int_abort+5
					     ; logical sector disk read 
     456 = 0026                      C  int_disk_write      EQU     int_abort+6
					     ; logical sector disk write 
     457 = 0027                      C  int_keep_process    EQU     int_abort+7
					     ; terminate program and stay 
     458                             C                                         
					     ; resident 
     459                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     460                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     461                             C  ;                                      
					                                    ; 
     462 = 0028                      C  int_spooler         EQU     int_abort+8
					     ; spooler call 
     463 = 0029                      C  int_fastcon         EQU     int_abort+9
					     ; fast CON interrupt 
     464                             C  ;                                      
					                                    ; 
     465                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     466                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     467                             C          ENDIF 
     468                             C   
     469 = 0080                      C  addr_int_abort          EQU    4 * int_
					abort 
     470 = 0084                      C  addr_int_command        EQU    4 * int_
					command 
     471 = 0088                      C  addr_int_terminate      EQU    4 * int_
					terminate 
     472 = 008C                      C  addr_int_ctrl_c         EQU    4 * int_
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-27
interrupt definitions                                       

					ctrl_c 
     473 = 0090                      C  addr_int_fatal_abort    EQU    4 * int_
					fatal_abort 
     474 = 0094                      C  addr_int_disk_read      EQU    4 * int_
					disk_read 
     475 = 0098                      C  addr_int_disk_write     EQU    4 * int_
					disk_write 
     476 = 009C                      C  addr_int_keep_process   EQU    4 * int_
					keep_process 
     477                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     478                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     479                             C  ;                                      
					                                    ; 
     480 = 00A0                      C  addr_int_spooler        EQU    4 * int_
					spooler 
     481 = 00A4                      C  addr_int_fastcon        EQU    4 * int_
					fastcon 
     482                             C  ;                                      
					                                    ; 
     483                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     484                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     485                             C   
     486                             C  BREAK <Disk map> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-28
Disk map                                                    

     487                             C  ;  MSDOS partitions the disk into 4 sec
					tions: 
     488                             C  ; 
     489                             C  ;  phys sector 0:   +------------------
					-+ 
     490                             C  ;       |           | boot/reserved    
					 | 
     491                             C  ;       |           +------------------
					-+ 
     492                             C  ;       |           |  File allocation 
					 | 
     493                             C  ;       v           |      table(s)    
					 | 
     494                             C  ;                   |  (multiple copies
					 | 
     495                             C  ;                   |     are kept)    
					 | 
     496                             C  ;                   +------------------
					-+ 
     497                             C  ;                   |     Directory    
					 | 
     498                             C  ;                   +------------------
					-+ 
     499                             C  ;                   |     File space   
					 | 
     500                             C  ;                   +------------------
					-+ 
     501                             C  ;                   |   Unaddressable  
					 | 
     502                             C  ;                   |  (to end of disk)
					 | 
     503                             C  ;                   +------------------
					-+ 
     504                             C  ; 
     505                             C  ; All partition boundaries are sector b
					oundaries.  The size of the FAT is 
     506                             C  ; adjusted to maximize the file space a
					ddressable. 
     507                             C   
     508                             C  BREAK <Directory entry> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-29
Directory entry                                             

     509                             C   
     510                             C  ; 
     511                             C  ;       +---------------------------+ 
     512                             C  ;       |  (12 BYTE) filename/ext   |  
					     0       0 
     513                             C  ;       +---------------------------+ 
     514                             C  ;       |     (BYTE) attributes     |  
					     11      B 
     515                             C  ;       +---------------------------+ 
     516                             C  ;       |    (10 BYTE) reserved     |  
					     12      C 
     517                             C  ;       +---------------------------+ 
     518                             C  ;       | (WORD) time of last write |  
					     22      16 
     519                             C  ;       +---------------------------+ 
     520                             C  ;       | (WORD) date of last write |  
					     24      18 
     521                             C  ;       +---------------------------+ 
     522                             C  ;       |   (WORD) First cluster    |  
					     26      1A 
     523                             C  ;       +---------------------------+ 
     524                             C  ;       |     (DWORD) file size     |  
					     28      1C 
     525                             C  ;       +---------------------------+ 
     526                             C  ; 
     527                             C  ;   First byte of filename  = E5 -> fre
					e directory entry 
     528                             C  ;                           = 00 -> end
					 of allocated directory 
     529                             C  ;   Time:   Bits 0-4=seconds/2, bits 5-
					10=minute, 11-15=hour 
     530                             C  ;   Date:   Bits 0-4=day, bits 5-8=mont
					h, bits 9-15=year-1980 
     531                             C  ; 
     532                             C  dir_entry   STRUC 
     533 0000  000B[                 C  dir_name    DB      11 DUP (?)         
					 ; file name 
     534            ??               C  
     535                         ]   C  
     536                             C  
     537 000B  ??                    C  dir_attr    DB      ?                  
					 ; attribute bits 
     538 000C  000A[                 C  dir_pad     DB      10 DUP (?)         
					 ; reserved for expansion 
     539            ??               C  
     540                         ]   C  
     541                             C  
     542 0016  ????                  C  dir_time    DW      ?                  
					 ; time of last write 
     543 0018  ????                  C  dir_date    DW      ?                  
					 ; date of last write 
     544 001A  ????                  C  dir_first   DW      ?                  
					 ; first allocation unit of file 
     545 001C  ????                  C  dir_size_l  DW      ?                  
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-30
Directory entry                                             

					 ; low 16 bits of file size 
     546 001E  ????                  C  dir_size_h  DW      ?                  
					 ; high 16 bits of file size 
     547 0020                        C  dir_entry   ENDS 
     548                             C   
     549 = 0001                      C  attr_read_only      EQU      1h 
     550 = 0002                      C  attr_hidden         EQU      2h 
     551 = 0004                      C  attr_system         EQU      4h 
     552 = 0008                      C  attr_volume_id      EQU      8h 
     553 = 0010                      C  attr_directory      EQU     10h 
     554 = 0020                      C  attr_archive        EQU     20h 
     555                             C   
     556 = 0016                      C  attr_all            EQU     attr_hidden
					+attr_system+attr_directory 
     557                             C                                         
					 ; OR of hard attributes for FINDENTRY 
     558                             C   
     559 = 0021                      C  attr_ignore         EQU     attr_read_o
					nly+attr_archive 
     560                             C                                         
					 ; ignore this(ese) attribute(s) during
					 
     561                             C                                         
					 ; search first/next 
     562                             C   
     563 = 0027                      C  attr_changeable     EQU     attr_read_o
					nly+attr_hidden+attr_system+attr_archiv
					e 
     564                             C                                         
					 ; changeable via CHMOD 
     565                             C   
     566                             C  BREAK <File allocation Table informatio
					n> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-31
File allocation Table information                           

     567                             C  ; 
     568                             C  ; The File Allocation Table uses a 12-b
					it entry for each allocation unit on 
     569                             C  ; the disk.  These entries are packed, 
					two for every three bytes.  The content
					s 
     570                             C  ; of entry number N is found by 1) mult
					iplying N by 1.5; 2) adding the result 
     571                             C  ; to the base address of the Allocation
					 Table; 3) fetching the 16-bit word 
     572                             C  ; at this address; 4) If N was odd (so 
					that N*1.5 was not an integer), shift 
     573                             C  ; the word right four bits; 5) mask to 
					12 bits (AND with 0FFF hex).  Entry 
     574                             C  ; number zero is used as an end-of-file
					 trap in the OS and is passed to the 
     575                             C  ; BIOS to help determine disk format.  
					Entry 1 is reserved for future use. 
     576                             C  ; The first available allocation unit i
					s assigned entry number two, and even 
     577                             C  ; though it is the first, is called clu
					ster 2.  Entries greater than 0FF8H 
     578                             C  ; are end of file marks; entries of zer
					o are unallocated.  Otherwise, the 
     579                             C  ; contents of a FAT entry is the number
					 of the next cluster in the file. 
     580                             C  ; 
     581                             C  ; Clusters with bad sectors are tagged 
					with FF7H.  Any non-zero number would 
     582                             C  ; do because these clusters show as all
					ocated, but are not part of any 
     583                             C  ; allocation chain and thus will never 
					be allocated to a file.  A particular 
     584                             C  ; number is selected so that disk check
					ing programs know what to do (ie.  a 
     585                             C  ; cluster with entry FF7H which is not 
					in a chain is not an error). 
     586                             C   
     587                             C  BREAK <DPB structure> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-32
DPB structure                                               

     588                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     589                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     590                             C  ;                                      
					                                    ; 
     591                             C   
     592 = 0040                      C  DIRSTRLEN       EQU     64      ; Max l
					ength in bytes of directory strings 
     593                             C   
     594                             C  dpb     STRUC 
     595 0000  ??                    C  dpb_drive           DB      ?   ; Logic
					al drive # assoc with DPB (A=0,B=1,...)
					 
     596 0001  ??                    C  dpb_UNIT            DB      ?   ; Drive
					r unit number of DPB 
     597 0002  ????                  C  dpb_sector_size     DW      ?   ; Size 
					of physical sector in bytes 
     598 0004  ??                    C  dpb_cluster_mask    DB      ?   ; Secto
					rs/cluster - 1 
     599 0005  ??                    C  dpb_cluster_shift   DB      ?   ; Log2 
					of sectors/cluster 
     600 0006  ????                  C  dpb_first_FAT       DW      ?   ; Start
					ing record of FATs 
     601 0008  ??                    C  dpb_FAT_count       DB      ?   ; Numbe
					r of FATs for this drive 
     602 0009  ????                  C  dpb_root_entries    DW      ?   ; Numbe
					r of directory entries 
     603 000B  ????                  C  dpb_first_sector    DW      ?   ; First
					 sector of first cluster 
     604 000D  ????                  C  dpb_max_cluster     DW      ?   ; Numbe
					r of clusters on drive + 1 
     605 000F  ??                    C  dpb_FAT_size        DB      ?   ; Numbe
					r of records occupied by FAT 
     606 0010  ????                  C  dpb_dir_sector      DW      ?   ; Start
					ing record of directory 
     607 0012  ????????              C  dpb_driver_addr     DD      ?   ; Point
					er to driver 
     608 0016  ??                    C  dpb_media           DB      ?   ; Media
					 byte 
     609 0017  ??                    C  dpb_first_access    DB      ?   ; This 
					is initialized to -1 to force a media 
     610                             C                                  ; check
					 the first time this DPB is used 
     611 0018  ????????              C  dpb_next_dpb        DD      ?   ; Point
					er to next Drive parameter block 
     612 001C  ????                  C  dpb_current_dir     DW      ?   ; Clust
					er number of start of current directory
					 
     613                             C                                  ; 0 ind
					icates root, -1 indicates invalid (disk
					 
     614                             C                                  ; ?  ch
					anged) 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-33
DPB structure                                               

     615 001E  0040[                 C  dpb_dir_text        DB      DIRSTRLEN D
					UP(?) 
     616            ??               C  
     617                         ]   C  
     618                             C  
     619                             C                                  ; ASCIZ
					 string of current directory 
     620 005E                        C  dpb     ENDS 
     621                             C   
     622 = 005E                      C  DPBSIZ  EQU     SIZE dpb        ; Size 
					of the structure in bytes 
     623                             C   
     624 = 000D                      C  DSKSIZ  =       dpb_max_cluster ; Size 
					of disk (temp used during init only) 
     625                             C  ;                                      
					                                    ; 
     626                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     627                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     628                             C   
     629                             C  BREAK <File Control Block definition> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-34
File Control Block definition                               

     630                             C  ; 
     631                             C  ; Field definition for FCBs 
     632                             C  ; The FCB has the following structure: 
     633                             C  ; 
     634                             C  ;       +---------------------------+ 
     635                             C  ;       |   Drive indicator(byte)   | 
     636                             C  ;       +---------------------------+ 
     637                             C  ;       |    Filename (8 chars)     | 
     638                             C  ;       +---------------------------+ 
     639                             C  ;       |    Extension (3 chars)    | 
     640                             C  ;       +---------------------------+ 
     641                             C  ;       |   Current Extent(word)    | 
     642                             C  ;       +---------------------------+ 
     643                             C  ;       |    Record size (word)     | 
     644                             C  ;       +---------------------------+ 
     645                             C  ;       |    File Size (2 words)    | 
     646                             C  ;       +---------------------------+ 
     647                             C  ;       |       Date of write       | 
     648                             C  ;       +---------------------------+ 
     649                             C  ;       |       Time of write       | 
     650                             C  ;       +---------------------------+ 
     651                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     652                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     653                             C  ;                                      
					                                    ; 
     654                             C  ;       | Flags:                    | 
     655                             C  ;       |  bit 7=0 file/1 device    | 
     656                             C  ;       |  bit 6=0 if dirty         | 
     657                             C  ;       |  bits 0-5 deviceid        | 
     658                             C  ;       +---------------------------+ 
     659                             C  ;       |   first cluster in file   | 
     660                             C  ;       +---------------------------+ 
     661                             C  ;       | position of last cluster  | 
     662                             C  ;       +---------------------------+ 
     663                             C  ;       |   last cluster accessed   |  
					 12 bit-+--- packed in 3 bytes 
     664                             C  ;       +---------------------------+  
					        | 
     665                             C  ;       |     parent directory      |  
					 <------+ 
     666                             C  ;       +---------------------------+ 
     667                             C  ;                                      
					                                    ; 
     668                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     669                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     670                             C  ;       |    next record number     | 
     671                             C  ;       +---------------------------+ 
     672                             C  ;       |   random record number    | 
     673                             C  ;       +---------------------------+ 
     674                             C  ; 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-35
File Control Block definition                               

     675                             C   
     676                             C  sys_fcb     STRUC 
     677 0000  ??                    C  fcb_drive   DB      ? 
     678 0001  0008[                 C  fcb_name    DB      8 DUP (?) 
     679            ??               C  
     680                         ]   C  
     681                             C  
     682 0009  0003[                 C  fcb_ext     DB      3 DUP (?) 
     683            ??               C  
     684                         ]   C  
     685                             C  
     686 000C  ????                  C  fcb_EXTENT  DW      ? 
     687 000E  ????                  C  fcb_RECSIZ  DW      ?       ; Size of r
					ecord (user settable) 
     688 0010  ????                  C  fcb_FILSIZ  DW      ?       ; Size of f
					ile in bytes; used with the following 
     689                             C                              ; word 
     690 0012  ????                  C  fcb_DRVBP   DW      ?       ; BP for SE
					ARCH FIRST and SEARCH NEXT 
     691 0014  ????                  C  fcb_FDATE   DW      ?       ; Date of l
					ast writing 
     692 0016  ????                  C  fcb_FTIME   DW      ?       ; Time of l
					ast writing 
     693                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     694                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     695                             C  ;                                      
					                                    ; 
     696 0018  ??                    C  fcb_DEVID   DB      ?       ; Device ID
					 number, bits 0-5 if file. 
     697                             C                              ; bit 7=0 f
					or file, bit 7=1 for I/O device 
     698                             C                              ; If file, 
					bit 6=0 if dirty 
     699                             C                              ; If I/O de
					vice, bit 6=0 if EOF (input) 
     700                             C                              ;          
					     Bit 5=1 if Raw mode 
     701                             C                              ;          
					     Bit 0=1 if console input device 
     702                             C                              ;          
					     Bit 1=1 if console output device 
     703                             C                              ;          
					     Bit 2=1 if null device 
     704                             C                              ;          
					     Bit 3=1 if clock device 
     705 0019  ????                  C  fcb_FIRCLUS DW      ?       ; First clu
					ster of file 
     706 001B  ????                  C  fcb_CLUSPOS DW      ?       ; Position 
					of last cluster accessed 
     707 001D  ????                  C  fcb_LSTCLUS DW      ?       ; Last clus
					ter accessed and directory pack 2 12 
     708 001F  ??                    C              DB      ?       ; bit numbe
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-36
File Control Block definition                               

					rs into 24 bits... 
     709                             C  ;                                      
					                                    ; 
     710                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     711                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     712 0020  ??                    C  fcb_NR      DB      ?       ; Next reco
					rd 
     713 0021  0004[                 C  fcb_RR      DB      4 DUP (?)          
					     ; Random record 
     714            ??               C  
     715                         ]   C  
     716                             C  
     717 0025                        C  sys_fcb     ENDS 
     718                             C   
     719 = 0010                      C  FILDIRENT       = fcb_FILSIZ           
					 ; Used only by SEARCH FIRST and SEARCH
					 
     720                             C                                         
					 ; NEXT 
     721                             C   
     722                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     723                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     724                             C  ;                                      
					                                    ; 
     725 = 0040                      C  devid_file_clean        EQU     40h    
					 ; true if file and not written 
     726 = 003F                      C  devid_file_mask_drive   EQU     3Fh    
					 ; mask for drive number 
     727                             C   
     728 = 0080                      C  devid_device            EQU     80h    
					 ; true if a device 
     729 = 0040                      C  devid_device_EOF        EQU     40h    
					 ; true if end of file reached 
     730 = 0020                      C  devid_device_raw        EQU     20h    
					 ; true if in raw mode 
     731 = 0010                      C  devid_device_special    EQU     10h    
					 ; true if special device 
     732 = 0008                      C  devid_device_clock      EQU     08h    
					 ; true if clock device 
     733 = 0004                      C  devid_device_null       EQU     04h    
					 ; true if null device 
     734 = 0002                      C  devid_device_con_out    EQU     02h    
					 ; true if console output 
     735 = 0001                      C  devid_device_con_in     EQU     01h    
					 ; true if consle input 
     736                             C   
     737                             C  ; 
     738                             C  ; structure of devid field as returned 
					by IOCTL is: 
     739                             C  ; 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-37
File Control Block definition                               

     740                             C  ;       BIT     7   6   5   4   3   2  
					 1   0 
     741                             C  ;             |---|---|---|---|---|---|
					---|---| 
     742                             C  ;             | I | E | R | S | I | I |
					 I | I | 
     743                             C  ;             | S | O | A | P | S | S |
					 S | S | 
     744                             C  ;             | D | F | W | E | C | N |
					 C | C | 
     745                             C  ;             | E |   |   | C | L | U |
					 O | I | 
     746                             C  ;             | V |   |   | L | K | L |
					 T | N | 
     747                             C  ;             |---|---|---|---|---|---|
					---|---| 
     748                             C  ;       ISDEV = 1 if this channel is a 
					device 
     749                             C  ;             = 0 if this channel is a 
					disk file 
     750                             C  ; 
     751                             C  ;       If ISDEV = 1 
     752                             C  ; 
     753                             C  ;             EOF = 0 if End Of File on
					 input 
     754                             C  ;             RAW = 1 if this device is
					 in Raw mode 
     755                             C  ;                 = 0 if this device is
					 cooked 
     756                             C  ;             ISCLK = 1 if this device 
					is the clock device 
     757                             C  ;             ISNUL = 1 if this device 
					is the null device 
     758                             C  ;             ISCOT = 1 if this device 
					is the console output 
     759                             C  ;             ISCIN = 1 if this device 
					is the console input 
     760                             C  ; 
     761                             C  ;       If ISDEV = 0 
     762                             C  ;             EOF = 0 if channel has be
					en written 
     763                             C  ;             Bits 0-5  are  the  block
					  device  number  for 
     764                             C  ;                 the channel (0 = A, 1
					 = B, ...) 
     765                             C  ; 
     766 = 0080                      C  devid_ISDEV     EQU     80h 
     767 = 0040                      C  devid_EOF       EQU     40h 
     768 = 0020                      C  devid_RAW       EQU     20h 
     769 = 0010                      C  devid_SPECIAL   EQU     10H 
     770 = 0008                      C  devid_ISCLK     EQU     08h 
     771 = 0004                      C  devid_ISNUL     EQU     04h 
     772 = 0002                      C  devid_ISCOT     EQU     02h 
     773 = 0001                      C  devid_ISCIN     EQU     01h 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-38
File Control Block definition                               

     774                             C   
     775 = 001F                      C  devid_block_dev EQU     1Fh            
					 ; mask for block device number 
     776                             C   
     777                             C  ; 
     778                             C  ; find first/next buffer 
     779                             C  ; 
     780                             C  find_buf    STRUC 
     781 0000  ??                    C  find_buf_sattr      DB  ?           ; a
					ttribute of search 
     782 0001  ??                    C  find_buf_drive      DB  ?           ; d
					rive of search 
     783 0002  000B[                 C  find_buf_name       DB  11 DUP (?)  ; f
					ormatted name 
     784            ??               C  
     785                         ]   C  
     786                             C  
     787 000D  ????                  C  find_buf_LastEnt    DW  ?           ; L
					astEnt 
     788 000F  ????????              C  find_buf_ThisDPB    DD  ?           ; T
					his DPB 
     789 0013  ????                  C  find_buf_DirStart   DW  ?           ; D
					irStart 
     790                             C  ;                                      
					                                    ; 
     791                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     792                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     793                             C   
     794 0015  ??                    C  find_buf_attr       DB  ?           ; a
					ttribute found 
     795 0016  ????                  C  find_buf_time       DW  ?           ; t
					ime 
     796 0018  ????                  C  find_buf_date       DW  ?           ; d
					ate 
     797 001A  ????                  C  find_buf_size_l     DW  ?           ; l
					ow(size) 
     798 001C  ????                  C  find_buf_size_h     DW  ?           ; h
					igh(size) 
     799 001E  000D[                 C  find_buf_pname      DB  13 DUP (?)  ; p
					acked name 
     800            ??               C  
     801                         ]   C  
     802                             C  
     803 002B                        C  find_buf    ENDS 
     804                             C   
     805                             C  BREAK <Process data block> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-39
Process data block                                          

     806                             C  ; 
     807                             C  ; Process data block (otherwise known a
					s program header) 
     808                             C  ; 
     809                             C   
     810 = 0014                      C  FilPerProc          EQU     20 
     811                             C   
     812                             C  Process_data_block  STRUC 
     813 0000  ????                  C  PDB_Exit_Call       DW      ?          
					 ; INT int_abort system terminate 
     814 0002  ????                  C  PDB_block_len       DW      ?          
					 ; size of execution block 
     815 0004  ??                    C                      DB      ? 
     816 0005  0005[                 C  PDB_CPM_Call        DB  5 DUP (?)      
					 ; ancient call to system 
     817            ??               C  
     818                         ]   C  
     819                             C  
     820 000A  ????????              C  PDB_Exit            DD      ?          
					 ; pointer to exit routine 
     821 000E  ????????              C  PDB_Ctrl_C          DD      ?          
					 ; pointer to ^C routine 
     822 0012  ????????              C  PDB_Fatal_abort     DD      ?          
					 ; pointer to fatal error 
     823                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     824                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     825                             C  ;                                      
					                                    ; 
     826 0016  ????                  C  PDB_Parent_PID      DW      ?          
					 ; PID of parent (terminate PID) 
     827 0018  0014[                 C  PDB_JFN_Table       DB  FilPerProc DUP 
					(?) 
     828            ??               C  
     829                         ]   C  
     830                             C  
     831                             C                                         
					 ; indices into system table 
     832                             C  ;                                      
					                                    ; 
     833                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     834                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     835 002C  ????                  C  PDB_environ         DW      ?          
					 ; seg addr of environment 
     836                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     837                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     838                             C  ;                                      
					                                    ; 
     839 002E  ????????              C  PDB_User_stack      DD      ?          
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-40
Process data block                                          

					 ; stack of self during system calls 
     840 0032  001E[                 C  PDB_PAD1            DB      1Eh DUP (?)
					 
     841            ??               C  
     842                         ]   C  
     843                             C  
     844                             C  ;                                      
					                                    ; 
     845                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     846                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     847 0050  0005[                 C  PDB_Call_system     DB      5 DUP (?)  
					 ; portable method of system call 
     848            ??               C  
     849                         ]   C  
     850                             C  
     851                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     852                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     853                             C  ;                                      
					                                    ; 
     854 0055  0006[                 C  PDB_PAD2            DB      6h DUP (?) 
					 ; 
     855            ??               C  
     856                         ]   C  
     857                             C  
     858                             C  ;                                      
					                                    ; 
     859                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     860                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     861 005B                        C  Process_data_block  ENDS 
     862                             C   
     863                             C  BREAK <EXEC and EXE file structures> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-41
EXEC and EXE file structures                                

     864                             C  ; 
     865                             C  ; EXEC arg block - load/go program 
     866                             C  ; 
     867                             C   
     868                             C  ; 
     869                             C  ; The following get used as arguments t
					o the EXEC system call.  They indicate 
     870                             C  ; whether or not the program is execute
					d or whether or not a program header 
     871                             C  ; gets created. 
     872                             C  ; 
     873 = 0001                      C  exec_func_no_execute    EQU 1          
					 ; no execute bit 
     874 = 0002                      C  exec_func_overlay       EQU 2          
					 ; overlay bit 
     875                             C   
     876                             C  Exec0           STRUC 
     877 0000  ????                  C  Exec0_environ   DW      ?              
					 ; seg addr of environment 
     878 0002  ????????              C  Exec0_com_line  DD      ?              
					 ; pointer to asciz command line 
     879 0006  ????????              C  Exec0_5C_FCB    DD      ?              
					 ; default fcb at 5C 
     880 000A  ????????              C  Exec0_6C_FCB    DD      ?              
					 ; default fcb at 6C 
     881 000E                        C  Exec0           ENDS 
     882                             C   
     883                             C  Exec1           STRUC 
     884 0000  ????                  C  Exec1_environ   DW      ?              
					 ; seg addr of environment 
     885 0002  ????????              C  Exec1_com_line  DD      ?              
					 ; pointer to asciz command line 
     886 0006  ????????              C  Exec1_5C_FCB    DD      ?              
					 ; default fcb at 5C 
     887 000A  ????????              C  Exec1_6C_FCB    DD      ?              
					 ; default fcb at 6C 
     888 000E  ????                  C  Exec1_SP        DW      ?              
					 ; stack pointer of program 
     889 0010  ????                  C  Exec1_SS        DW      ?              
					 ; stack seg register of program 
     890 0012  ????                  C  Exec1_IP        DW      ?              
					 ; entry point IP 
     891 0014  ????                  C  Exec1_CS        DW      ?              
					 ; entry point CS 
     892 0016                        C  Exec1           ENDS 
     893                             C   
     894                             C  Exec3           STRUC 
     895 0000  ????                  C  Exec3_load_addr DW      ?              
					 ; seg address of load point 
     896 0002  ????                  C  Exec3_reloc_fac DW      ?              
					 ; relocation factor 
     897 0004                        C  Exec3           ENDS 
     898                             C   
     899                             C  ; 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-42
EXEC and EXE file structures                                

     900                             C  ; Exit codes in upper byte 
     901                             C  ; 
     902 = 0000                      C  Exit_terminate      EQU     0 
     903 = 0000                      C  Exit_abort          EQU     0 
     904 = 0001                      C  Exit_Ctrl_C         EQU     1 
     905 = 0002                      C  Exit_Hard_Error     EQU     2 
     906 = 0003                      C  Exit_Keep_process   EQU     3 
     907                             C   
     908                             C  ; 
     909                             C  ; EXE file header 
     910                             C  ; 
     911                             C   
     912                             C  EXE_file    STRUC 
     913 0000  ????                  C  exe_signature   DW  ?                  
					 ; must contain 4D5A  (yay zibo!) 
     914 0002  ????                  C  exe_len_mod_512 DW  ?                  
					 ; low 9 bits of length 
     915 0004  ????                  C  exe_pages       DW  ?                  
					 ; number of 512b pages in file 
     916 0006  ????                  C  exe_rle_count   DW  ?                  
					 ; count of reloc entries 
     917 0008  ????                  C  exe_par_dir     DW  ?                  
					 ; number of paragraphs before image 
     918 000A  ????                  C  exe_min_BSS     DW  ?                  
					 ; minimum number of para of BSS 
     919 000C  ????                  C  exe_max_BSS     DW  ?                  
					 ; max number of para of BSS 
     920 000E  ????                  C  exe_SS          DW  ?                  
					 ; stack of image 
     921 0010  ????                  C  exe_SP          DW  ?                  
					 ; SP of image 
     922 0012  ????                  C  exe_chksum      DW  ?                  
					 ; checksum  of file (ignored) 
     923 0014  ????                  C  exe_IP          DW  ?                  
					 ; IP of entry 
     924 0016  ????                  C  exe_CS          DW  ?                  
					 ; CS of entry 
     925 0018  ????                  C  exe_rle_table   DW  ?                  
					 ; byte offset of reloc table 
     926 001A  ????                  C  exe_iov         DW  ?                  
					 ; overlay number (0 for root) 
     927 001C  ????????              C  exe_sym_tab     DD  ?                  
					 ; offset of symbol table in file 
     928 0020                        C  EXE_file    ENDS 
     929                             C   
     930 = 5A4D                      C  exe_valid_signature     EQU 5A4Dh 
     931 = 4D5A                      C  exe_valid_old_signature EQU 4D5Ah 
     932                             C   
     933                             C  symbol_entry    STRUC 
     934 0000  ????????              C  sym_value       DD  ? 
     935 0004  ????                  C  sym_type        DW  ? 
     936 0006  ??                    C  sym_len         DB  ? 
     937 0007  00FF[                 C  sym_name        DB  255 dup (?) 
     938            ??               C  
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-43
EXEC and EXE file structures                                

     939                         ]   C  
     940                             C  
     941 0106                        C  symbol_entry    ENDS 
     942                             C   
     943                             C  BREAK <Internal system file table forma
					t> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-44
Internal system file table format                           

     944                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     945                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     946                             C  ;                                      
					                                    ; 
     947                             C  ; 
     948                             C  ; system file table 
     949                             C  ; 
     950                             C   
     951                             C  sft             STRUC 
     952 0000  ????????              C  sft_link        DD      ? 
     953 0004  ????                  C  sft_count       DW      ?              
					 ; number of entries 
     954 0006  ????                  C  sft_table       DW      ?              
					 ; beginning of array of the following 
     955 0008                        C  sft             ENDS 
     956                             C   
     957                             C  ; 
     958                             C  ; system file table entry 
     959                             C  ; 
     960                             C   
     961                             C  sf_entry        STRUC 
     962 0000  ??                    C  sf_ref_count    DB      ?              
					 ; number of processes sharing fcb 
     963 0001  ??                    C  sf_mode         DB      ?              
					 ; mode of access 
     964 0002  ??                    C  sf_attr         DB      ?              
					 ; attribute of file 
     965 0003  0025[                 C  sf_fcb          DB      (SIZE sys_fcb) 
					DUP (?) 
     966            ??               C  
     967                         ]   C  
     968                             C  
     969                             C                                         
					 ; actual FCB 
     970 0028                        C  sf_entry        ENDS 
     971                             C   
     972 = 0005                      C  sf_default_number   EQU     5h 
     973                             C  ;                                      
					                                    ; 
     974                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     975                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     976                             C   
     977                             C  BREAK <Memory arena structure> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-45
Memory arena structure                                      

     978                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
     979                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
     980                             C  ;                                      
					                                    ; 
     981                             C  ; 
     982                             C  ; arena item 
     983                             C  ; 
     984                             C  arena   STRUC 
     985 0000  ??                    C  arena_signature     DB  ?              
					 ; 4D for valid item, 5A for last item 
     986 0001  ????                  C  arena_owner         DW  ?              
					 ; owner of arena item 
     987 0003  ????                  C  arena_size          DW  ?              
					 ; size in paragraphs of item 
     988 0005                        C  arena   ENDS 
     989                             C   
     990                             C  ; 
     991                             C  ; Current structure of the data returne
					d by the international call 
     992                             C  ; 
     993                             C   
     994                             C  internat_block STRUC 
     995 0000  ????                  C  Date_tim_format DW      ?           ; 0
					-USA, 1-EUR, 2-JAP 
     996 0002  ??                    C  Currency_sym    DB      ?           ; C
					urrency Symbol 5 bytes 
     997 0003  ??                    C                  DB      ? 
     998 0004  ??                    C                  DB      ? 
     999 0005  ??                    C                  DB      ? 
    1000 0006  ??                    C                  DB      ? 
    1001 0007  ??                    C  Thous_sep       DB      ?           ; T
					housands separator 2 bytes 
    1002 0008  ??                    C                  DB      ? 
    1003 0009  ??                    C  Decimal_sep     DB      ?           ; D
					ecimal separator 2 bytes 
    1004 000A  ??                    C                  DB      ? 
    1005 000B  ??                    C  Date_sep        DB      ?           ; D
					ate separator 2 bytes 
    1006 000C  ??                    C                  DB      ? 
    1007 000D  ??                    C  Time_sep        DB      ?           ; D
					ecimal separator 2 bytes 
    1008 000E  ??                    C                  DB      ? 
    1009 000F  ??                    C  Bit_feild       DB      ?           ; B
					it values 
    1010                             C                                      ;  
					 Bit 0 = 0 if currency symbol first 
    1011                             C                                      ;  
					       = 1 if currency symbol last 
    1012                             C                                      ;  
					 Bit 1 = 0 if No space after currency s
					ymbol 
    1013                             C                                      ;  
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-46
Memory arena structure                                      

					       = 1 if space after currency symb
					ol 
    1014 0010  ??                    C  Currency_cents  DB      ?           ; N
					umber of places after currency dec poin
					t 
    1015 0011  ??                    C  Time_24         DB      ?           ; 1
					 if 24 hour time, 0 if 12 hour time 
    1016 0012  ????                  C  Map_call        DW      ?           ; A
					ddress of case mapping call (DWORD) 
    1017 0014  ????                  C                  DW      ?           ; T
					HIS IS TWO WORDS SO IT CAN BE INITIALIZ
					ED 
    1018                             C                                      ;  
					in pieces. 
    1019 0016  ??                    C  Data_sep        DB      ?           ; D
					ata list separator character 
    1020 0017  ??                    C                  DB      ? 
    1021 0018                        C  internat_block ENDS 
    1022                             C   
    1023                             C  ; 
    1024                             C  ; Max size of the block returned by the
					 INTERNATIONAL call 
    1025                             C  ; 
    1026 = 0020                      C  internat_block_max      EQU     32 
    1027                             C   
    1028                             C  ; 
    1029                             C  ; CAUTION: The routines in ALLOC.ASM re
					ly on the fact that arena_signature 
    1030                             C  ; and arena_owner_system are all equal 
					to zero and are contained in DI.  Chang
					e 
    1031                             C  ; them and change ALLOC.ASM. 
    1032                             C   
    1033 = 0000                      C  arena_owner_system  EQU 0              
					 ; free block indication 
    1034                             C   
    1035 = 004D                      C  arena_signature_normal  EQU 4Dh        
					 ; valid signature, not end of arena 
    1036 = 005A                      C  arena_signature_end     EQU 5Ah        
					 ; valid signature, last block in arena
					 
    1037                             C  ;                                      
					                                    ; 
    1038                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
    1039                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
    1040                             C   
    1041                             C  BREAK <Machine instruction definitions>
					 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-47
Machine instruction definitions                             

    1042                             C   
    1043 = 00CD                      C  mi_INT          EQU     0CDh 
    1044 = 00EA                      C  mi_Long_JMP     EQU     0EAh 
    1045 = 009A                      C  mi_Long_CALL    EQU     09Ah 
    1046 = 00CB                      C  mi_Long_RET     EQU     0CBh 
    1047                             C   
    1048                             C  BREAK <Standard I/O assignments> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-48
Standard I/O assignments                                    

    1049                             C   
    1050 = 0000                      C  stdin       EQU     0 
    1051 = 0001                      C  stdout      EQU     1 
    1052 = 0002                      C  stderr      EQU     2 
    1053 = 0003                      C  stdaux      EQU     3 
    1054 = 0004                      C  stdprn      EQU     4 
    1055                             C   
    1056                             C  BREAK <Xenix subfunction assignments> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-49
Xenix subfunction assignments                               

    1057                             C   
    1058 = 0000                      C  open_for_read   EQU 0 
    1059 = 0001                      C  open_for_write  EQU 1 
    1060 = 0002                      C  open_for_both   EQU 2 
    1061                             C   
    1062                             C  BREAK <Xenix error codes> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-50
Xenix error codes                                           

    1063                             C   
    1064                             C  ; 
    1065                             C  ; XENIX calls all return error codes th
					rough AX.  If an error occurred then 
    1066                             C  ; the carry bit will be set and the err
					or code is in AX.  If no error occurred
					 
    1067                             C  ; then the carry bit is reset and AX co
					ntains returned info. 
    1068                             C  ; 
    1069                             C   
    1070 =                           C  no_error_occurred               EQU    
					 0                                     
					                         ? 
    1071                             C   
    1072 = 0001                      C  error_invalid_function          EQU    
					 1 
    1073 = 0002                      C  error_file_not_found            EQU    
					 2 
    1074 = 0003                      C  error_path_not_found            EQU    
					 3 
    1075 = 0004                      C  error_too_many_open_files       EQU    
					 4 
    1076 = 0005                      C  error_access_denied             EQU    
					 5 
    1077 = 0006                      C  error_invalid_handle            EQU    
					 6 
    1078 = 0007                      C  error_arena_trashed             EQU    
					 7 
    1079 = 0008                      C  error_not_enough_memory         EQU    
					 8 
    1080 = 0009                      C  error_invalid_block             EQU    
					 9 
    1081 = 000A                      C  error_bad_environment           EQU    
					 10 
    1082 = 000B                      C  error_bad_format                EQU    
					 11 
    1083 = 000C                      C  error_invalid_access            EQU    
					 12 
    1084 = 000D                      C  error_invalid_data              EQU    
					 13 
    1085                             C  ;**** unused                    EQU    
					 14 
    1086 = 000F                      C  error_invalid_drive             EQU    
					 15 
    1087 = 0010                      C  error_current_directory         EQU    
					 16 
    1088 = 0011                      C  error_not_same_device           EQU    
					 17 
    1089 = 0012                      C  error_no_more_files             EQU    
					 18 
    1090                             C   
    1091 =                           C  country_not_found               EQU    
					 error_file_not_found 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-51
Xenix error codes                                           

    1092 =                           C  alloc_not_enough_memory         EQU    
					 error_not_enough_memory 
    1093 =                           C  alloc_arena_trashed             EQU    
					 error_arena_trashed 
    1094                             C   
    1095 =                           C  close_invalid_handle            EQU    
					 error_invalid_handle 
    1096 =                           C  close_invalid_function          EQU    
					 error_invalid_function 
    1097                             C   
    1098 =                           C  chdir_path_not_found            EQU    
					 error_path_not_found 
    1099                             C   
    1100 =                           C  chmod_path_not_found            EQU    
					 error_path_not_found 
    1101 =                           C  chmod_access_denied             EQU    
					 error_access_denied 
    1102 =                           C  chmod_invalid_function          EQU    
					 error_invalid_function 
    1103                             C   
    1104 =                           C  creat_access_denied             EQU    
					 error_access_denied 
    1105 =                           C  creat_path_not_found            EQU    
					 error_path_not_found 
    1106 =                           C  creat_too_many_open_files       EQU    
					 error_too_many_open_files 
    1107                             C   
    1108 =                           C  curdir_invalid_drive            EQU    
					 error_invalid_drive 
    1109                             C   
    1110 =                           C  dealloc_invalid_block           EQU    
					 error_invalid_block 
    1111 =                           C  dealloc_arena_trashed           EQU    
					 error_arena_trashed 
    1112                             C   
    1113 =                           C  dup_invalid_handle              EQU    
					 error_invalid_handle 
    1114 =                           C  dup_too_many_open_files         EQU    
					 error_too_many_open_files 
    1115                             C   
    1116 =                           C  dup2_invalid_handle             EQU    
					 error_invalid_handle 
    1117                             C   
    1118 =                           C  exec_invalid_function           EQU    
					 error_invalid_function 
    1119 =                           C  exec_bad_environment            EQU    
					 error_bad_environment 
    1120 =                           C  exec_bad_format                 EQU    
					 error_bad_format 
    1121 =                           C  exec_not_enough_memory          EQU    
					 error_not_enough_memory 
    1122 =                           C  exec_file_not_found             EQU    
					 error_file_not_found 
    1123                             C   
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-52
Xenix error codes                                           

    1124 =                           C  filetimes_invalid_function      EQU    
					 error_invalid_function 
    1125 =                           C  filetimes_invalid_handle        EQU    
					 error_invalid_handle 
    1126                             C   
    1127 =                           C  findfirst_file_not_found        EQU    
					 error_file_not_found 
    1128 =                           C  findfirst_no_more_files         EQU    
					 error_no_more_files 
    1129 =                           C  findnext_no_more_files          EQU    
					 error_no_more_files 
    1130                             C   
    1131 =                           C  international_invalid_function  EQU    
					 error_invalid_function 
    1132                             C   
    1133 =                           C  ioctl_invalid_handle            EQU    
					 error_invalid_handle 
    1134 =                           C  ioctl_invalid_function          EQU    
					 error_invalid_function 
    1135 =                           C  ioctl_invalid_data              EQU    
					 error_invalid_data 
    1136                             C   
    1137 =                           C  lseek_invalid_handle            EQU    
					 error_invalid_handle 
    1138 =                           C  lseek_invalid_function          EQU    
					 error_invalid_function 
    1139                             C   
    1140 =                           C  mkdir_path_not_found            EQU    
					 error_path_not_found 
    1141 =                           C  mkdir_access_denied             EQU    
					 error_access_denied 
    1142                             C   
    1143 =                           C  open_invalid_access             EQU    
					 error_invalid_access 
    1144 =                           C  open_file_not_found             EQU    
					 error_file_not_found 
    1145 =                           C  open_access_denied              EQU    
					 error_access_denied 
    1146 =                           C  open_too_many_open_files        EQU    
					 error_too_many_open_files 
    1147                             C   
    1148 =                           C  read_invalid_handle             EQU    
					 error_invalid_handle 
    1149 =                           C  read_access_denied              EQU    
					 error_access_denied 
    1150                             C   
    1151 =                           C  rename_file_not_found           EQU    
					 error_file_not_found 
    1152 =                           C  rename_not_same_device          EQU    
					 error_not_same_device 
    1153 =                           C  rename_access_denied            EQU    
					 error_access_denied 
    1154                             C   
    1155 =                           C  rmdir_path_not_found            EQU    
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-53
Xenix error codes                                           

					 error_path_not_found 
    1156 =                           C  rmdir_access_denied             EQU    
					 error_access_denied 
    1157 =                           C  rmdir_current_directory         EQU    
					 error_current_directory 
    1158                             C   
    1159 =                           C  setblock_invalid_block          EQU    
					 error_invalid_block 
    1160 =                           C  setblock_arena_trashed          EQU    
					 error_arena_trashed 
    1161 =                           C  setblock_not_enough_memory      EQU    
					 error_not_enough_memory 
    1162 =                           C  setblock_invalid_function       EQU    
					 error_invalid_function 
    1163                             C   
    1164 =                           C  unlink_file_not_found           EQU    
					 error_file_not_found 
    1165 =                           C  unlink_access_denied            EQU    
					 error_access_denied 
    1166                             C   
    1167 =                           C  write_invalid_handle            EQU    
					 error_invalid_handle 
    1168 =                           C  write_access_denied             EQU    
					 error_access_denied 
    1169                             C   
    1170                             C  BREAK <system call definitions> 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-54
system call definitions                                     

    1171                             C   
    1172 = 0000                      C  Abort                           EQU 0  
					 ;  0      0 
    1173 = 0001                      C  Std_Con_Input                   EQU 1  
					 ;  1      1 
    1174 = 0002                      C  Std_Con_Output                  EQU 2  
					 ;  2      2 
    1175 = 0003                      C  Std_Aux_Input                   EQU 3  
					 ;  3      3 
    1176 = 0004                      C  Std_Aux_Output                  EQU 4  
					 ;  4      4 
    1177 = 0005                      C  Std_Printer_Output              EQU 5  
					 ;  5      5 
    1178 = 0006                      C  Raw_Con_IO                      EQU 6  
					 ;  6      6 
    1179 = 0007                      C  Raw_Con_Input                   EQU 7  
					 ;  7      7 
    1180 = 0008                      C  Std_Con_Input_No_Echo           EQU 8  
					 ;  8      8 
    1181 = 0009                      C  Std_Con_String_Output           EQU 9  
					 ;  9      9 
    1182 = 000A                      C  Std_Con_String_Input            EQU 10 
					 ; 10      A 
    1183 = 000B                      C  Std_Con_Input_Status            EQU 11 
					 ; 11      B 
    1184 = 000C                      C  Std_Con_Input_Flush             EQU 12 
					 ; 12      C 
    1185 = 000D                      C  Disk_Reset                      EQU 13 
					 ; 13      D 
    1186 = 000E                      C  Set_Default_Drive               EQU 14 
					 ; 14      E 
    1187 = 000F                      C  FCB_Open                        EQU 15 
					 ; 15      F 
    1188 = 0010                      C  FCB_Close                       EQU 16 
					 ; 16     10 
    1189 = 0011                      C  Dir_Search_First                EQU 17 
					 ; 17     11 
    1190 = 0012                      C  Dir_Search_Next                 EQU 18 
					 ; 18     12 
    1191 = 0013                      C  FCB_Delete                      EQU 19 
					 ; 19     13 
    1192 = 0014                      C  FCB_Seq_Read                    EQU 20 
					 ; 20     14 
    1193 = 0015                      C  FCB_Seq_Write                   EQU 21 
					 ; 21     15 
    1194 = 0016                      C  FCB_Create                      EQU 22 
					 ; 22     16 
    1195 = 0017                      C  FCB_Rename                      EQU 23 
					 ; 23     17 
    1196 = 0019                      C  Get_Default_Drive               EQU 25 
					 ; 25     19 
    1197 = 001A                      C  Set_DMA                         EQU 26 
					 ; 26     1A 
    1198                             C  ;----+----+----+----+----+----+----+---
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-55
system call definitions                                     

					-+----+----+----+----+----+----+----; 
    1199                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
    1200                             C  ;                                      
					                                    ; 
    1201 = 001F                      C  Get_Default_DPB                 EQU 31 
					 ; 31     1F 
    1202                             C  ;                                      
					                                    ; 
    1203                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
    1204                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
    1205 = 0021                      C  FCB_Random_Read                 EQU 33 
					 ; 33     21 
    1206 = 0022                      C  FCB_Random_Write                EQU 34 
					 ; 34     22 
    1207 = 0023                      C  Get_FCB_File_Length             EQU 35 
					 ; 35     23 
    1208 = 0024                      C  Get_FCB_Position                EQU 36 
					 ; 36     24 
    1209 = 0025                      C  Set_Interrupt_Vector            EQU 37 
					 ; 37     25 
    1210 = 0026                      C  Create_Process_Data_Block       EQU 38 
					 ; 38     26 
    1211 = 0027                      C  FCB_Random_Read_Block           EQU 39 
					 ; 39     27 
    1212 = 0028                      C  FCB_Random_Write_Block          EQU 40 
					 ; 40     28 
    1213 = 0029                      C  Parse_File_Descriptor           EQU 41 
					 ; 41     29 
    1214 = 002A                      C  Get_Date                        EQU 42 
					 ; 42     2A 
    1215 = 002B                      C  Set_Date                        EQU 43 
					 ; 43     2B 
    1216 = 002C                      C  Get_Time                        EQU 44 
					 ; 44     2C 
    1217 = 002D                      C  Set_Time                        EQU 45 
					 ; 45     2D 
    1218 = 002E                      C  Set_Verify_On_Write             EQU 46 
					 ; 46     2E 
    1219                             C  ; Extended functionality group 
    1220 = 002F                      C  Get_DMA                         EQU 47 
					 ; 47     2F 
    1221 = 0030                      C  Get_Version                     EQU 48 
					 ; 48     30 
    1222 = 0031                      C  Keep_Process                    EQU 49 
					 ; 49     31 
    1223                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
    1224                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
    1225                             C  ;                                      
					                                    ; 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-56
system call definitions                                     

    1226 = 0032                      C  Get_DPB                         EQU 50 
					 ; 50     32 
    1227                             C  ;                                      
					                                    ; 
    1228                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
    1229                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
    1230 = 0033                      C  Set_CTRL_C_Trapping             EQU 51 
					 ; 51     33 
    1231 = 0034                      C  Get_InDOS_Flag                  EQU 52 
					 ; 52     34 
    1232 = 0035                      C  Get_Interrupt_Vector            EQU 53 
					 ; 53     35 
    1233 = 0036                      C  Get_Drive_Freespace             EQU 54 
					 ; 54     36 
    1234 = 0037                      C  Char_Oper                       EQU 55 
					 ; 55     37 
    1235 = 0038                      C  International                   EQU 56 
					 ; 56     38 
    1236                             C  ;   Directory Group 
    1237 = 0039                      C  MKDir                           EQU 57 
					 ; 57     39 
    1238 = 003A                      C  RMDir                           EQU 58 
					 ; 58     3A 
    1239 = 003B                      C  CHDir                           EQU 59 
					 ; 59     3B 
    1240                             C  ;   File Group 
    1241 = 003C                      C  Creat                           EQU 60 
					 ; 60     3C 
    1242 = 003D                      C  Open                            EQU 61 
					 ; 61     3D 
    1243 = 003E                      C  Close                           EQU 62 
					 ; 62     3E 
    1244 = 003F                      C  Read                            EQU 63 
					 ; 63     3F 
    1245 = 0040                      C  Write                           EQU 64 
					 ; 64     40 
    1246 = 0041                      C  Unlink                          EQU 65 
					 ; 65     41 
    1247 = 0042                      C  LSeek                           EQU 66 
					 ; 66     42 
    1248 = 0043                      C  CHMod                           EQU 67 
					 ; 67     43 
    1249 = 0044                      C  IOCtl                           EQU 68 
					 ; 68     44 
    1250 = 0045                      C  XDup                            EQU 69 
					 ; 69     45 
    1251 = 0046                      C  XDup2                           EQU 70 
					 ; 70     46 
    1252 = 0047                      C  Current_Dir                     EQU 71 
					 ; 71     47 
    1253                             C  ;    Memory Group 
    1254 = 0048                      C  Alloc                           EQU 72 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-57
system call definitions                                     

					 ; 72     48 
    1255 = 0049                      C  Dealloc                         EQU 73 
					 ; 73     49 
    1256 = 004A                      C  Setblock                        EQU 74 
					 ; 74     4A 
    1257                             C  ;    Process Group 
    1258 = 004B                      C  Exec                            EQU 75 
					 ; 75     4B 
    1259 = 004C                      C  Exit                            EQU 76 
					 ; 76     4C 
    1260 = 004D                      C  Wait                            EQU 77 
					 ; 77     4D 
    1261 = 004E                      C  Find_First                      EQU 78 
					 ; 78     4E 
    1262                             C  ;   Special Group 
    1263 = 004F                      C  Find_Next                       EQU 79 
					 ; 79     4F 
    1264                             C  ; SPECIAL SYSTEM GROUP 
    1265                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
    1266                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
    1267                             C  ;                                      
					                                    ; 
    1268 = 0050                      C  Set_Current_PDB                 EQU 80 
					 ; 80     50 
    1269 = 0051                      C  Get_Current_PDB                 EQU 81 
					 ; 81     51 
    1270 = 0052                      C  Get_In_Vars                     EQU 82 
					 ; 82     52 
    1271 = 0053                      C  SetDPB                          EQU 83 
					 ; 83     53 
    1272                             C  ;                                      
					                                    ; 
    1273                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
    1274                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
    1275 = 0054                      C  Get_Verify_On_Write             EQU 84 
					 ; 84     54 
    1276                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
    1277                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
    1278                             C  ;                                      
					                                    ; 
    1279 = 0055                      C  Dup_PDB                         EQU 85 
					 ; 85     55 
    1280                             C  ;                                      
					                                    ; 
    1281                             C  ;            C  A  V  E  A  T     P  R 
					 O  G  R  A  M  M  E  R             ; 
    1282                             C  ;----+----+----+----+----+----+----+---
					-+----+----+----+----+----+----+----; 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-58
system call definitions                                     

    1283 = 0056                      C  Rename                          EQU 86 
					 ; 86     56 
    1284 = 0057                      C  File_Times                      EQU 87 
					 ; 87     57 
    1285 = 0058                      C  AllocOper                       EQU 88 
					 ; 88     58 
    1286                             C  ; Network extention system calls 
    1287 = 0059                      C  GetExtendedError                EQU 89 
					 ; 89     59 
    1288 = 005A                      C  CreateTempFile                  EQU 90 
					 ; 90     5A 
    1289 = 005B                      C  CreateNewFile                   EQU 91 
					 ; 91     5B 
    1290 = 005C                      C  LockOper                        EQU 92 
					 ; 92     5C Lock and Unlock 
    1291 = 005D                      C  ServerCall                      EQU 93 
					 ; 93     5D CommitAll, ServerDOSCall, 
    1292                             C                                         
					 ;           CloseByName, CloseUser, 
    1293                             C                                         
					 ;           CloseUserProcess, 
    1294                             C                                         
					 ;           GetOpenFileList 
    1295 = 005E                      C  UserIDOper                      EQU 94 
					 ; 94     5E Get and Set 
    1296 = 005F                      C  AssignOper                      EQU 95 
					 ; 95     5F On, Off, Get, Set, Cancel 
    1297                             C   
    1298 = 00F8                      C  Set_Oem_Handler                 EQU 248
					 ; 248    F8 
    1299 = 00F9                      C  OEM_C1                          EQU 249
					 ; 249    F9 
    1300 = 00FA                      C  OEM_C2                          EQU 250
					 ; 250    FA 
    1301 = 00FB                      C  OEM_C3                          EQU 251
					 ; 251    FB 
    1302 = 00FC                      C  OEM_C4                          EQU 252
					 ; 252    FC 
    1303 = 00FD                      C  OEM_C5                          EQU 253
					 ; 253    FD 
    1304 = 00FE                      C  OEM_C6                          EQU 254
					 ; 254    FE 
    1305 = 00FF                      C  OEM_C7                          EQU 255
					 ; 255    FF 
    1306                             C  SUBTTL 
    1307                                 
    1308                                 
    1309 = 005C                         FCB     EQU     5CH 
    1310                                 
    1311                                ;Drive parameter block from DOS header 
    1312                                 
    1313                                SUBTTL  Segments used in load order 
    1314                                 
    1315 0000                           CODE    SEGMENT PUBLIC 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-59
Segments used in load order                                 

    1316 0000                           CODE    ENDS 
    1317                                 
    1318 0000                           CONST   SEGMENT PUBLIC BYTE 
    1319 0000                           CONST   ENDS 
    1320                                 
    1321 0000                           DATA    SEGMENT PUBLIC WORD 
    1322 0000                           DATA    ENDS 
    1323                                 
    1324                                DG      GROUP   CODE,CONST,DATA 
    1325                                 
    1326                                SUBTTL  Initialized Data 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-60
Initialized Data                                            

    1327                                PAGE 
    1328 0000                           CONST   SEGMENT PUBLIC BYTE 
    1329                                 
    1330                                        PUBLIC  HECODE,SWITCHAR,NOISY,D
					OFIX,CONBUF,ORPHCNT,ORPHSIZ,DOFIX 
    1331                                        PUBLIC  HIDCNT,HIDSIZ,DIRCNT,DI
					RSIZ,FILCNT,FILSIZ,BADSIZ,LCLUS 
    1332                                        PUBLIC  DOTENT,HAVFIX,SECONDPAS
					S,NUL,ALLFILE,PARSTR,ERRSUB,LCLUS 
    1333                                        PUBLIC  DIRTYFAT,BADSIZ,DDOTENT
					,CROSSCNT,ORPHFCB,ORPHEXT,ALLDRV 
    1334                                        PUBLIC  FRAGMENT,USERDIR,DIRBUF
					,USERDIR,FIXMFLG,DOTMES,DIRCHAR 
    1335                                 
    1336                                        EXTRN   IDMES1:BYTE,IDPOST:BYTE
					,VNAME:BYTE,MONTAB:BYTE 
    1337                                        EXTRN   TCHAR:BYTE,BADREAD_PRE:
					BYTE,BADREAD_POST:BYTE 
    1338                                        EXTRN   CRLF:BYTE,BADVER:BYTE,B
					ADSUBDIR:BYTE,CENTRY:BYTE 
    1339                                        EXTRN   BADDRV:BYTE,BADCD:BYTE,
					BADRDMES:BYTE,OPNERR:BYTE 
    1340                                        EXTRN   CONTAINS:BYTE,EXTENTS:B
					YTE,NOEXTENTS:BYTE 
    1341                                        EXTRN   BADDRVM:BYTE,BADDRVM2:B
					YTE,BADIDBYT:BYTE 
    1342                                 
    1343                                 
    1344 0000                           DIRBUF  LABEL   BYTE                   
					 ;Entry buffer for searches 
    1345 0000  FF 00 00 00 00 00 08     VOLID   DB      -1,0,0,0,0,0,8         
					 ;Volume ID FCB 
    1346 0007  00 3F 3F 3F 3F 3F 3F     VOLNAM  DB      0,"???????????" 
    1347       3F 3F 3F 3F 3F           
    1348 0013  0019[                            DB      25 DUP(0) 
    1349            00                  
    1350                         ]      
    1351                                
    1352                                 
    1353 002C  FF 00 00 00 00 00 1E     ALLFILE DB      -1,0,0,0,0,0,1EH       
					 ;Extended FCB 
    1354 0033  00 3F 3F 3F 3F 3F 3F     ALLDRV  DB      0,"???????????" 
    1355       3F 3F 3F 3F 3F           
    1356 003F  0019[                            DB      25 DUP (?) 
    1357            ??                  
    1358                         ]      
    1359                                
    1360                                 
    1361 0058  00 46 49 4C 45 30 30     ORPHFCB DB      0,"FILE0000" 
    1362       30 30                    
    1363 0061  43 48 4B                 ORPHEXT DB      "CHK" 
    1364 0064  0019[                            DB      25 DUP (?) 
    1365            ??                  
    1366                         ]      
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-61
Initialized Data                                            

    1367                                
    1368                                 
    1369                                 
    1370                                ;Non-message data 
    1371                                 
    1372 007D  2D                       SWITCHAR DB     "-" 
    1373 007E                           ROOTSTR LABEL   BYTE 
    1374 007E  2F                       DIRCHAR DB      "/" 
    1375 007F  00                       NUL     DB      0 
    1376 0080  2E 2E 00                 PARSTR  DB      "..",0 
    1377 0083  2E 00                    DOTMES  DB      ".",0 
    1378 0085  2E 20 20 20 20 20 20     DOTENT  DB      ".          " 
    1379       20 20 20 20              
    1380 0090  2E 2E 20 20 20 20 20     DDOTENT DB      "..         " 
    1381       20 20 20 20              
    1382 009B  ??                       HECODE  DB      ? 
    1383 009C  00                       FIXMFLG DB      0                      
					 ;Flag for printing fixmes 
    1384 009D  0000                     ERRSUB  DW      0                      
					 ;Flag for bad subdir error 
    1385 009F  00                       FRAGMENT DB     0                      
					 ;Flag for extent processing 
    1386 00A0  00                       DIRTYFAT DB     0                      
					 ;Dirty flag for FAT 
    1387 00A1  0000                     DIRCNT  DW      0                      
					 ;# directories 
    1388 00A3  0000                     DIRSIZ  DW      0                      
					 ;# alloc units in directories 
    1389 00A5  0000                     FILCNT  DW      0                      
					 ;# reg files 
    1390 00A7  0000                     FILSIZ  DW      0                      
					 ;# alloc units in reg files 
    1391 00A9  0000                     HIDCNT  DW      0                      
					 ;# hidden files 
    1392 00AB  0000                     HIDSIZ  DW      0                      
					 ;# alloc units in hidden files 
    1393 00AD  0000                     BADSIZ  DW      0                      
					 ;# alloc units in bad sectors 
    1394 00AF  0000                     ORPHCNT DW      0                      
					 ;# orphan files made 
    1395 00B1  0000                     ORPHSIZ DW      0                      
					 ;# alloc units in orphan files 
    1396 00B3  0000                     LCLUS   DW      0                      
					 ;# alloc units in lost clusters 
    1397 00B5  00                       DISPFLG DB      0                      
					 ;used by number routines 
    1398 00B6  0000                     CROSSCNT DW     0                      
					 ;# crosslinked files (first pass) 
    1399 00B8  00                       SECONDPASS DB   0                      
					 ;Pass flag 
    1400 00B9  00                       HAVFIX  DB      0                      
					 ;non zero if any fixes 
    1401 00BA  00                       DOFIX   DB      0                      
					 ;flag for F switch 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-62
Initialized Data                                            

    1402 00BB  00                       NOISY   DB      0                      
					 ;flag for V switch 
    1403 00BC  2F 00                    USERDIR DB      "/",0                  
					 ;Users current dir for drive 
    1404 00BE  003F[                            DB      (DIRSTRLEN-1) DUP (?) 
    1405            ??                  
    1406                         ]      
    1407                                
    1408 00FD  0F 00                    CONBUF  DB      15,0                   
					 ;Input buffer 
    1409 00FF  000F[                            DB      15 DUP (?) 
    1410            ??                  
    1411                         ]      
    1412                                
    1413                                 
    1414 010E                           CONST   ENDS 
    1415                                 
    1416                                SUBTTL  Un-initialized Data 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-63
Un-initialized Data                                         

    1417                                PAGE 
    1418 0000                           DATA    SEGMENT PUBLIC WORD 
    1419                                 
    1420                                        PUBLIC  ZEROTRUNC,NAMBUF,MCLUS,
					THISDPB,STACKLIM,ERRCNT 
    1421                                        PUBLIC  SRFCBPT,ISCROSS,CSIZE,D
					SIZE,SSIZE,FAT,FATMAP 
    1422                                        PUBLIC  HARDCH,CONTCH,USERDEV,S
					ECBUF,DOTSNOGOOD 
    1423                                 
    1424 0000  ????????                 HARDCH  DD      ?                      
					 ;Pointer to real INT 24 handler 
    1425 0004  ????????                 CONTCH  DD      ?                      
					 ;Pointer to real INT 23 handler 
    1426 0008  ????????                 THISDPB DD      ?                      
					 ;Pointer to drive DPB 
    1427 000C  ??                       USERDEV DB      ?                      
					 ;Users current device 
    1428 000D  ??                       CSIZE   DB      ?                      
					 ;Sectors per cluster 
    1429 000E  ????                     SSIZE   DW      ?                      
					 ;bytes per sector 
    1430 0010  ????                     DSIZE   DW      ?                      
					 ;# alloc units on disk 
    1431 0012  ????                     MCLUS   DW      ?                      
					 ;DSIZE + 1 
    1432 0014  000E[                    NAMBUF  DB      14 DUP (?)             
					 ;Buffer 
    1433            ??                  
    1434                         ]      
    1435                                
    1436 0022  ??                       DOTSNOGOOD DB   ?                      
					 ;. or .. error flag 
    1437 0023  ??                       ZEROTRUNC DB    ?                      
					 ;Trimming flag 
    1438 0024  ??                       ISCROSS DB      ?                      
					 ;Crosslink flag 
    1439 0025  ????                     OLDCLUS DW      ? 
    1440 0027  ????                     SRFCBPT DW      ? 
    1441 0029  0050 R                   FATMAP  DW      OFFSET DG:FAT          
					 ;Offset of FATMAP table 
    1442 002B  ????                     SECBUF  DW      ?                      
					 ;Offset of sector buffer 
    1443 002D  ??                       ERRCNT  DB      ?                      
					 ;Used by FATread and write 
    1444 002E  ????                     STACKLIM DW     ?                      
					 ;Stack growth limit 
    1445                                 
    1446 0030  ????                     INTERNATVARS    internat_block <> 
    1447 0032  ??                       
    1448 0033  ??                       
    1449 0034  ??                       
    1450 0035  ??                       
    1451 0036  ??                       
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-64
Un-initialized Data                                         

    1452 0037  ??                       
    1453 0038  ??                       
    1454 0039  ??                       
    1455 003A  ??                       
    1456 003B  ??                       
    1457 003C  ??                       
    1458 003D  ??                       
    1459 003E  ??                       
    1460 003F  ??                       
    1461 0040  ??                       
    1462 0041  ??                       
    1463 0042  ????                     
    1464 0044  ????                     
    1465 0046  ??                       
    1466 0047  ??                       
    1467                                
    1468 0048  0008[                                    DB      (internat_block
					_max - ($ - INTERNATVARS)) DUP (?) 
    1469            ??                  
    1470                         ]      
    1471                                
    1472                                 
    1473 0050                           FAT     LABEL   WORD 
    1474 0050                           DATA    ENDS 
    1475                                 
    1476                                 
    1477                                SUBTTL  Start of CHKDSK 
    1478                                 
    1479 0000                           CODE    SEGMENT PUBLIC 
    1480                                ASSUME  CS:DG,DS:DG,ES:DG,SS:DG 
    1481                                 
    1482                                        PUBLIC  SUBERRP,DOTCOMBMES,FIGR
					EC,FCB_TO_ASCZ,PRTCHR,EPRINT 
    1483                                        PUBLIC  PRINT,DOCRLF,DISP16BITS
					,DISP32BITS,DISPCLUS,CHECKFILES 
    1484                                 
    1485                                        EXTRN   RDSKERR:NEAR,SETSWITCH:
					NEAR,PROMPTYN:NEAR,REPORT:NEAR 
    1486                                        EXTRN   PRINTCURRDIRERR:NEAR,PR
					INTTHISEL2:NEAR,CHECKERR:NEAR 
    1487                                        EXTRN   INT_23:NEAR,INT_24:NEAR
					,FINDCHAIN:NEAR,DONE:NEAR,AMDONE:NEAR 
    1488                                        EXTRN   FATAL:NEAR,DIRPROC:NEAR
					,CHKMAP:NEAR,CHKCROSS:NEAR,UNPACK:NEAR 
    1489                                 
    1490 0100                                   ORG     100H 
    1491                                 
    1492 0100                           CHKDSK: 
    1493 0100  EB 08                            JMP     SHORT CHSTRT 
    1494                                 
    1495 0102  56 65 72 20 32 2E 33     HEADER  DB      "Ver 2.30" 
    1496       30                       
    1497                                 
    1498 010A                           CHSTRT: 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-65
Start of CHKDSK                                             

    1499                                 
    1500                                ;Code to print header. 
    1501                                ;       PUSH    AX 
    1502                                ;       MOV     DX,OFFSET DG:HEADER 
    1503                                ;       CALL    PRINT 
    1504                                ;       POP     AX 
    1505                                 
    1506 010A  50                               PUSH    AX              ;Save D
					RIVE validity info 
    1507 010B  B4 30                            MOV     AH,GET_VERSION 
    1508 010D  CD 21                            INT     21H 
    1509 010F  86 E0                            XCHG    AH,AL           ;Turn i
					t around to AH.AL 
    1510 0111  3D 0136                          CMP     AX,DOSVER_LOW 
    1511 0114  72 05                            JB      GOTBADDOS 
    1512 0116  3D 020B                          CMP     AX,DOSVER_HIGH 
    1513 0119  76 06                            JBE     OKDOS 
    1514 011B                           GOTBADDOS: 
    1515 011B  BA 0000 E                        MOV     DX,OFFSET DG:BADVER 
    1516 011E  EB 31 90                         JMP     CERROR 
    1517                                 
    1518 0121                           OKDOS: 
    1519 0121  58                               POP     AX              ;Get ba
					ck drive info 
    1520 0122  BB FFF0                          MOV     BX,0FFF0H 
    1521 0125  8B D4                            MOV     DX,SP 
    1522 0127  3B D3                            CMP     DX,BX 
    1523 0129  73 19                            JAE     STACKOK         ;Lots o
					f stack 
    1524 012B  8B 16 0002                       MOV     DX,DS:[2]       ;High b
					reak 
    1525 012F  8C C9                            MOV     CX,CS 
    1526 0131  2B D1                            SUB     DX,CX 
    1527 0133  81 FA 0FFF                       CMP     DX,0FFFH 
    1528 0137  73 07                            JAE     SETSTACK        ;Lots t
					o grab 
    1529 0139  B9 0004                          MOV     CX,4            ;Suck u
					p more stack (blast command) 
    1530 013C  D3 E2                            SHL     DX,CL 
    1531 013E  8B DA                            MOV     BX,DX 
    1532 0140                           SETSTACK: 
    1533 0140  FA                               CLI 
    1534 0141  8B E3                            MOV     SP,BX 
    1535 0143  FB                               STI 
    1536 0144                           STACKOK: 
    1537 0144  50                               PUSH    AX 
    1538 0145  B4 0D                            MOV     AH,DISK_RESET        ;F
					lush everything, and invalidate 
    1539 0147  CD 21                            INT     21H 
    1540 0149  58                               POP     AX 
    1541 014A  3C FF                            CMP     AL,0FFH                
					 ;Illegal drive specifier? 
    1542 014C  75 11                            JNZ     FILECHK                
					 ;No -- check for filename 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-66
Start of CHKDSK                                             

    1543                                 
    1544 014E                           DRVERR: 
    1545 014E  BA 0000 E                        MOV     DX,OFFSET DG:BADDRV 
    1546 0151                           CERROR: 
    1547 0151  0E                               PUSH    CS                     
					 ;Make sure DS is OK 
    1548 0152  1F                               POP     DS 
    1549 0153  E8 05F5 R                        CALL    PRINT                  
					 ;Print error message 
    1550 0156  CD 20                            INT     20H 
    1551                                 
    1552 0158                           CERROR2: 
    1553 0158  52                               PUSH    DX 
    1554 0159  E8 0000 E                        CALL    DONE                   
					         ;Reset users disk 
    1555 015C  5A                               POP     DX 
    1556 015D  EB F2                            JMP     SHORT CERROR 
    1557                                 
    1558 015F                           FILECHK: 
    1559 015F  B8 3700                          MOV     AX,(CHAR_OPER SHL 8) 
    1560 0162  CD 21                            INT     21H 
    1561 0164  88 16 007D R                     MOV     [SWITCHAR],DL 
    1562 0168  80 FA 2F                         CMP     DL,"/" 
    1563 016B  75 0A                            JNZ     SLASHOK 
    1564 016D  C6 06 007E R 5C                  MOV     [DIRCHAR],"\" 
    1565 0172  C6 06 00BC R 5C                  MOV     [USERDIR],"\" 
    1566 0177                           SLASHOK: 
    1567 0177  80 3E 005D 20                    CMP     DS:(BYTE PTR FCB+1)," "
					         ;Filename specified? 
    1568 017C  74 0E                            JZ      DRVCHK                 
					         ;No -- get the correct drive 
    1569 017E  A0 007D R                        MOV     AL,[SWITCHAR] 
    1570 0181  38 06 005D                       CMP     DS:(BYTE PTR FCB+1),AL 
					         ;Filename specified? 
    1571 0185  74 05                            JZ      DRVCHK                 
					         ;No -- get the correct drive 
    1572 0187  C6 06 009F R 01                  MOV     BYTE PTR [FRAGMENT],1  
					         ;Set flag to perform fragment 
    1573                                                                       
					         ;check on specified files 
    1574 018C                           DRVCHK: 
    1575 018C  E8 0000 E                        CALL    SETSWITCH              
					         ;Look for switches 
    1576 018F  B4 19                            MOV     AH,GET_DEFAULT_DRIVE   
					         ;Get current drive 
    1577 0191  CD 21                            INT     21H 
    1578 0193  A2 000C R                        MOV     [USERDEV],AL           
					         ;Save for later 
    1579 0196  8A E0                            MOV     AH,AL 
    1580 0198  FE C4                            INC     AH                     
					 ;A = 1 
    1581 019A  8A 3E 005C                       MOV     BH,DS:(BYTE PTR FCB)   
					 ;See if drive specified 
    1582 019E  0A FF                            OR      BH,BH 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-67
Start of CHKDSK                                             

    1583 01A0  74 06                            JZ      SETDSK 
    1584 01A2  8A C7                            MOV     AL,BH 
    1585 01A4  8A E0                            MOV     AH,AL 
    1586 01A6  FE C8                            DEC     AL                     
					 ;A = 0 
    1587 01A8                           SETDSK: 
    1588 01A8  88 26 0033 R                     MOV     [ALLDRV],AH            
					 ;Target drive 
    1589 01AC  88 26 0007 R                     MOV     [VOLNAM],AH            
					 ;A = 1 
    1590 01B0  88 26 0058 R                     MOV     [ORPHFCB],AH           
					 ;A = 1 
    1591 01B4  00 06 0000 E                     ADD     [BADDRVM],AL           
					 ;A = 0 
    1592 01B8  00 06 0000 E                     ADD     [BADDRVM2],AL          
					 ;A = 0 
    1593 01BC  8A D4                            MOV     DL,AH                  
					 ;A = 1 
    1594 01BE  B4 32                            MOV     AH,GET_DPB             
					 ;Get the DPB 
    1595 01C0  CD 21                            INT     21H 
    1596                                ASSUME  DS:NOTHING 
    1597 01C2  3C FF                            CMP     AL,-1 
    1598 01C4  75 05                            JNZ     DRVISOK                
					 ;Bad drive (should always be ok) 
    1599 01C6  BA 0000 E                        MOV     DX,OFFSET DG:BADDRV 
    1600 01C9  EB 8D                    CERROR2J: JMP    CERROR2 
    1601                                 
    1602 01CB                           DRVISOK: 
    1603 01CB  FE CA                            DEC     DL                     
					 ;A = 0 
    1604 01CD  B4 0E                            MOV     AH,SET_DEFAULT_DRIVE   
					 ;Set Target 
    1605 01CF  CD 21                            INT     21H 
    1606 01D1  83 7F 1C 00                      CMP     [BX.dpb_current_dir],0 
    1607 01D5  74 10                            JZ      CURRISROOT             
					 ;Save users current dir for target 
    1608 01D7  8B F3                            MOV     SI,BX 
    1609 01D9  83 C6 1E                         ADD     SI,dpb_dir_text 
    1610 01DC  BF 00BD R                        MOV     DI,OFFSET DG:USERDIR + 
					1 
    1611 01DF                           SETDIRLP: 
    1612 01DF  AC                               LODSB 
    1613 01E0  AA                               STOSB 
    1614 01E1  0A C0                            OR      AL,AL 
    1615 01E3  74 02                            JZ      CURRISROOT 
    1616 01E5  EB F8                            JMP     SHORT SETDIRLP 
    1617 01E7                           CURRISROOT: 
    1618 01E7  36: 8C 1E 000A R                 MOV     WORD PTR [THISDPB+2],DS
					 
    1619 01EC  0E                               PUSH    CS 
    1620 01ED  1F                               POP     DS 
    1621                                ASSUME  DS:DG 
    1622 01EE  89 1E 0008 R                     MOV     WORD PTR [THISDPB],BX 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-68
Start of CHKDSK                                             

    1623 01F2  B8 3523                          MOV     AX,(GET_INTERRUPT_VECTO
					R SHL 8) OR 23H 
    1624 01F5  CD 21                            INT     21H 
    1625 01F7  89 1E 0004 R                     MOV     WORD PTR [CONTCH],BX 
    1626 01FB  8C 06 0006 R                     MOV     WORD PTR [CONTCH+2],ES 
    1627 01FF  B8 2523                          MOV     AX,(SET_INTERRUPT_VECTO
					R SHL 8) OR 23H 
    1628 0202  BA 0000 E                        MOV     DX,OFFSET DG:INT_23 
    1629 0205  CD 21                            INT     21H 
    1630 0207  B8 3524                          MOV     AX,(GET_INTERRUPT_VECTO
					R SHL 8) OR 24H 
    1631 020A  CD 21                            INT     21H 
    1632 020C  89 1E 0000 R                     MOV     WORD PTR [HARDCH],BX 
    1633 0210  8C 06 0002 R                     MOV     WORD PTR [HARDCH+2],ES 
    1634 0214  B8 2524                          MOV     AX,(SET_INTERRUPT_VECTO
					R SHL 8) OR 24H 
    1635 0217  BA 0000 E                        MOV     DX,OFFSET DG:INT_24 
    1636 021A  CD 21                            INT     21H 
    1637 021C  0E                               PUSH    CS 
    1638 021D  07                               POP     ES 
    1639 021E  BA 007E R                        MOV     DX,OFFSET DG:ROOTSTR 
    1640 0221  B4 3B                            MOV     AH,CHDIR               
					         ;Start at root 
    1641 0223  CD 21                            INT     21H 
    1642 0225  BA 0000 E                        MOV     DX,OFFSET DG:BADCD 
    1643 0228  72 9F                            JC      CERROR2J               
					         ;Couldn't get there 
    1644 022A  BA 0050 R                        MOV     DX,OFFSET DG:FAT       
					         ;Scratch space 
    1645 022D  B4 1A                            MOV     AH,SET_DMA 
    1646 022F  CD 21                            INT     21H 
    1647 0231  BA 0000 R                        MOV     DX,OFFSET DG:VOLID     
					         ;Look for VOL ID 
    1648 0234  B4 11                            MOV     AH,DIR_SEARCH_FIRST 
    1649 0236  CD 21                            INT     21H 
    1650 0238  3C FF                            CMP     AL,-1 
    1651 023A  74 03                            JZ      NOTVOLID 
    1652 023C  E8 03CC R                        CALL    PRINTID                
					         ;Have a VOL ID 
    1653 023F                           NOTVOLID: 
    1654 023F  C5 1E 0008 R                     LDS     BX,[THISDPB] 
    1655                                ASSUME  DS:NOTHING 
    1656 0243  8B 47 02                         MOV     AX,[BX.dpb_sector_size]
					 
    1657 0246  36: A3 000E R                    MOV     [SSIZE],AX             
					 ;Sector size in bytes 
    1658 024A  8A 47 04                         MOV     AL,[BX.dpb_cluster_mask
					] 
    1659 024D  FE C0                            INC     AL 
    1660 024F  36: A2 000D R                    MOV     [CSIZE],AL             
					 ;Sectros per cluster 
    1661 0253  8B 47 0D                         MOV     AX,[BX.dpb_max_cluster]
					 
    1662 0256  36: A3 0012 R                    MOV     [MCLUS],AX             
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-69
Start of CHKDSK                                             

					 ;Bound for FAT searching 
    1663 025A  48                               DEC     AX 
    1664 025B  36: A3 0010 R                    MOV     [DSIZE],AX             
					 ;Total data clusters on disk 
    1665 025F  8A 47 0F                         MOV     AL,[BX.dpb_FAT_size]   
					       ;Sectors for one fat 
    1666 0262  32 E4                            XOR     AH,AH 
    1667 0264  8B C8                            MOV     CX,AX 
    1668 0266  36: F7 26 000E R                 MUL     [SSIZE]                
					 ;Bytes for FAT 
    1669 026B  36: 01 06 0029 R                 ADD     [FATMAP],AX            
					 ;Allocate FAT space 
    1670 0270  36: A1 0029 R                    MOV     AX,[FATMAP] 
    1671 0274  36: 03 06 0012 R                 ADD     AX,[MCLUS] 
    1672 0279  05 0002                          ADD     AX,2                   
					 ;Insurance 
    1673 027C  36: A3 002B R                    MOV     [SECBUF],AX            
					 ;Allocate FATMAP space 
    1674 0280  36: 03 06 000E R                 ADD     AX,[SSIZE] 
    1675 0285  05 0014                          ADD     AX,20                  
					 ;Insurance 
    1676 0288  36: A3 002E R                    MOV     [STACKLIM],AX          
					 ;Limit on recursion 
    1677 028C  8B F9                            MOV     DI,CX 
    1678 028E  8A 4F 08                         MOV     CL,[BX.dpb_FAT_count]  
					        ;Number of FATs 
    1679 0291  8B 57 06                         MOV     DX,[BX.dpb_first_FAT]  
					        ;First sector of FAT 
    1680 0294  0E                               PUSH    CS 
    1681 0295  1F                               POP     DS 
    1682                                ASSUME  DS:DG 
    1683 0296  BB 0050 R                        MOV     BX,OFFSET DG:FAT 
    1684 0299  A0 0033 R                        MOV     AL,[ALLDRV] 
    1685 029C  FE C8                            DEC     AL 
    1686 029E  B4 31                            MOV     AH,'1' 
    1687 02A0                           RDLOOP: 
    1688 02A0  87 CF                            XCHG    CX,DI 
    1689 02A2  52                               PUSH    DX 
    1690 02A3  51                               PUSH    CX 
    1691 02A4  57                               PUSH    DI 
    1692 02A5  50                               PUSH    AX 
    1693 02A6  CD 25                            INT     25H                    
					 ;Read in the FAT 
    1694 02A8  A2 009B R                        MOV     [HECODE],AL 
    1695 02AB  58                               POP     AX                     
					 ;Flags 
    1696 02AC  73 2B                            JNC     RDOK 
    1697 02AE  BA 0000 E                        MOV     DX,OFFSET DG:BADREAD_PR
					E    ;Barfed 
    1698 02B1  E8 05F5 R                        CALL    PRINT 
    1699 02B4  58                               POP     AX 
    1700 02B5  50                               PUSH    AX 
    1701 02B6  8A D4                            MOV     DL,AH 
    1702 02B8  E8 05DE R                        CALL    PRTCHR 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-70
Start of CHKDSK                                             

    1703 02BB  BA 0000 E                        MOV     DX,OFFSET DG:BADREAD_PO
					ST 
    1704 02BE  E8 05F5 R                        CALL    PRINT 
    1705 02C1  58                               POP     AX 
    1706 02C2  59                               POP     CX 
    1707 02C3  5F                               POP     DI 
    1708 02C4  5A                               POP     DX 
    1709 02C5  FE C4                            INC     AH 
    1710 02C7  03 D7                            ADD     DX,DI 
    1711 02C9  E2 D5                            LOOP    RDLOOP                 
					 ;Try next FAT 
    1712 02CB  E8 0000 E                        CALL    RDSKERR 
    1713 02CE  75 03                            JNZ     NORETRY1 
    1714 02D0  E9 023F R                        JMP     NOTVOLID 
    1715 02D3                           NORETRY1: 
    1716 02D3  BB 0000 E                        MOV     BX,OFFSET DG:BADRDMES 
    1717 02D6  E9 0000 E                        JMP     FATAL                  
					 ;Couldn't read any FAT, BARF 
    1718                                 
    1719 02D9                           RDOK: 
    1720 02D9  58                               POP     AX                     
					 ;Clean up 
    1721 02DA  58                               POP     AX 
    1722 02DB  58                               POP     AX 
    1723 02DC  58                               POP     AX 
    1724 02DD  BE 0050 R                        MOV     SI,OFFSET DG:FAT 
    1725 02E0  AC                               LODSB                          
					 ;Check FAT ID byte 
    1726 02E1  3C F8                            CMP     AL,0F8H 
    1727 02E3  73 0B                            JAE     IDOK 
    1728 02E5  BA 0000 E                        MOV     DX,OFFSET DG:BADIDBYT  
					 ;FAT ID bad 
    1729 02E8  E8 0000 E                        CALL    PROMPTYN               
					 ;Ask user 
    1730 02EB  74 03                            JZ      IDOK 
    1731 02ED  EB 28 90                         JMP     ALLDONE                
					 ;User said stop 
    1732 02F0                           IDOK: 
    1733 02F0  8B 3E 0029 R                     MOV     DI,[FATMAP] 
    1734 02F4  8B 0E 0012 R                     MOV     CX,[MCLUS] 
    1735 02F8  41                               INC     CX 
    1736 02F9  32 C0                            XOR     AL,AL 
    1737 02FB  F3/ AA                           REP     STOSB                  
					 ;Initialize FATMAP to all free 
    1738 02FD  BA 0000 R                        MOV     DX,OFFSET DG:DIRBUF    
					 ;FOR ALL SEARCHING 
    1739 0300  B4 1A                            MOV     AH,SET_DMA 
    1740 0302  CD 21                            INT     21H 
    1741 0304  33 C0                            XOR     AX,AX 
    1742 0306  50                               PUSH    AX                     
					 ;I am root 
    1743 0307  50                               PUSH    AX                     
					 ;Parent is root 
    1744 0308  E8 0000 E                        CALL    DIRPROC 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-71
Start of CHKDSK                                             

    1745 030B  E8 0000 E                        CALL    CHKMAP                 
					 ;Look for badsectors, orphans 
    1746 030E  E8 0000 E                        CALL    CHKCROSS               
					 ;Check for second pass 
    1747 0311  E8 05F2 R                        CALL    DOCRLF 
    1748 0314  E8 0000 E                        CALL    REPORT 
    1749                                 
    1750 0317                           ALLDONE: 
    1751 0317  E8 0000 E                        CALL    AMDONE 
    1752 031A  CD 20                            INT     20H                    
					 ;Fini 
    1753                                 
    1754                                 
    1755                                ASSUME  DS:DG 
    1756                                 
    1757                                SUBTTL  Check for extents in specified 
					files 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-72
Check for extents in specified files                        

    1758                                PAGE 
    1759 031C                           CHECKFILES: 
    1760                                ;Search the directory for the files spe
					cified on the command line 
    1761                                ;and report the number of fragmented al
					location units found in 
    1762                                ;each one. 
    1763 031C  E8 05F2 R                        CALL    DOCRLF 
    1764 031F  B4 1A                            MOV     AH,SET_DMA 
    1765 0321  8B 16 0029 R                     MOV     DX,[FATMAP]            
					 ;Use the first free space available 
    1766 0325  8B EA                            MOV     BP,DX 
    1767 0327  83 C5 1B                         ADD     BP,27                  
					 ;cluster in the directory entry 
    1768 032A  CD 21                            INT     21H 
    1769 032C  B4 11                            MOV     AH,DIR_SEARCH_FIRST    
					          ;Look for the first file 
    1770 032E                           FRAGCHK: 
    1771 032E  BA 005C                          MOV     DX,FCB 
    1772 0331  CD 21                            INT     21H 
    1773 0333  0A C0                            OR      AL,AL                  
					 ;Did we find it? 
    1774 0335  75 5D                            JNZ     MSGCHK                 
					 ;No -- we're done 
    1775 0337  33 C0                            XOR     AX,AX                  
					 ;Initialize the fragment counter 
    1776 0339  8B 76 00                         MOV     SI,[BP]                
					 ;Get the first cluster 
    1777 033C  E8 0000 E                        CALL    UNPACK 
    1778 033F  81 FF 0FF8                       CMP     DI,0FF8H               
					 ;End-of-file? 
    1779 0343  73 24                            JAE     NXTCHK                 
					 ;Yes -- go report the results 
    1780 0345  46                               INC     SI 
    1781 0346  3B F7                            CMP     SI,DI 
    1782 0348  74 01                            JZ      EACHCLUS 
    1783 034A  40                               INC     AX 
    1784 034B                           EACHCLUS: 
    1785 034B  89 3E 0025 R                     MOV     [OLDCLUS],DI           
					 ;Save the last cluster found 
    1786 034F  8B F7                            MOV     SI,DI                  
					 ;Get the next cluster 
    1787 0351  E8 0000 E                        CALL    UNPACK 
    1788 0354  FF 06 0025 R                     INC     [OLDCLUS]              
					 ;Bump the old cluster 
    1789 0358  3B 3E 0025 R                     CMP     DI,[OLDCLUS]           
					 ;Are they the same? 
    1790 035C  75 02                            JNZ     LASTCLUS               
					 ;No -- check for end-of-file 
    1791 035E  EB EB                            JMP     SHORT EACHCLUS         
					 ;Continue processing 
    1792 0360                           LASTCLUS: 
    1793 0360  81 FF 0FF8                       CMP     DI,0FF8H               
					 ;End-of-file? 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-73
Check for extents in specified files                        

    1794 0364  73 03                            JAE     NXTCHK                 
					 ;Yes -- go report the results 
    1795 0366  40                               INC     AX                     
					 ;No -- found a fragement 
    1796 0367  EB E2                            JMP     SHORT EACHCLUS         
					 ;Continue processing 
    1797                                 
    1798 0369                           NXTCHK: 
    1799 0369  0B C0                            OR      AX,AX 
    1800 036B  74 23                            JZ      GETNXT 
    1801 036D  C6 06 009F R 02                  MOV     [FRAGMENT],2           
					 ;Signal that we output at least one fi
					le 
    1802 0372  50                               PUSH    AX                     
					 ;Save count of fragments 
    1803 0373  8B 36 0029 R                     MOV     SI,[FATMAP] 
    1804 0377  46                               INC     SI 
    1805 0378  E8 0000 E                        CALL    PRINTTHISEL2 
    1806 037B  E8 05F2 R                        CALL    DOCRLF 
    1807 037E  BA 0000 E                        MOV     DX,OFFSET DG:CONTAINS  
					 ;Print message 
    1808 0381  E8 05F5 R                        CALL    PRINT 
    1809 0384  5E                               POP     SI                     
					 ;Number of fragments found 
    1810 0385  46                               INC     SI                     
					 ;Number non-contig blocks 
    1811 0386  33 FF                            XOR     DI,DI 
    1812 0388  BB 0000 E                        MOV     BX,OFFSET DG:EXTENTS 
    1813 038B  55                               PUSH    BP 
    1814 038C  E8 0552 R                        CALL    DISP16BITS 
    1815 038F  5D                               POP     BP 
    1816 0390                           GETNXT: 
    1817 0390  B4 12                            MOV     AH,DIR_SEARCH_NEXT     
					         ;Look for the next file 
    1818 0392  EB 9A                            JMP     FRAGCHK 
    1819                                 
    1820 0394                           MSGCHK: 
    1821 0394  80 FC 11                         CMP     AH,DIR_SEARCH_FIRST 
    1822 0397  75 10                            JNZ     FILSPOK 
    1823 0399  BE 005D                          MOV     SI,FCB + 1             
					 ;File not found error 
    1824 039C  E8 0000 E                        CALL    PRINTTHISEL2 
    1825 039F  E8 05F2 R                        CALL    DOCRLF 
    1826 03A2  BA 0000 E                        MOV     DX,OFFSET DG:OPNERR 
    1827 03A5  E8 05F5 R                        CALL    PRINT                  
					 ;Bad file spec 
    1828 03A8  C3                               RET 
    1829 03A9                           FILSPOK: 
    1830 03A9  80 3E 009F R 02                  CMP     BYTE PTR [FRAGMENT],2 
    1831 03AE  74 06                            JZ      CDONE 
    1832 03B0  BA 0000 E                        MOV     DX,OFFSET DG:NOEXTENTS 
    1833 03B3  E8 05F5 R                        CALL    PRINT 
    1834 03B6                           CDONE: 
    1835 03B6  C3                               RET 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-74
Check for extents in specified files                        

    1836                                 
    1837                                 
    1838 03B7                           FIGREC: 
    1839                                ;Convert cluster number in BX to sector
					 # AH of cluster in DX 
    1840 03B7  C5 3E 0008 R                     LDS     DI,[THISDPB] 
    1841                                ASSUME  DS:NOTHING 
    1842 03BB  8A 4D 05                         MOV     CL,[DI.dpb_cluster_shif
					t] 
    1843 03BE  8B D3                            MOV     DX,BX 
    1844 03C0  4A                               DEC     DX 
    1845 03C1  4A                               DEC     DX 
    1846 03C2  D3 E2                            SHL     DX,CL 
    1847 03C4  0A D4                            OR      DL,AH 
    1848 03C6  03 55 0B                         ADD     DX,[DI.dpb_first_sector
					] 
    1849 03C9  0E                               PUSH    CS 
    1850 03CA  1F                               POP     DS 
    1851                                ASSUME  DS:DG 
    1852 03CB  C3                               RET 
    1853                                 
    1854                                 
    1855                                SUBTTL  PRINTID - Print Volume ID info 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-75
PRINTID - Print Volume ID info                              

    1856                                PAGE 
    1857 03CC                           PRINTID: 
    1858                                ASSUME  DS:DG 
    1859 03CC  BA 0030 R                        MOV     DX,OFFSET DG:INTERNATVA
					RS 
    1860 03CF  B8 3800                          MOV     AX,INTERNATIONAL SHL 8 
    1861 03D2  CD 21                            INT     21H 
    1862 03D4  C6 06 00B5 R 01                  MOV     [DISPFLG],1            
					 ;Don't sub spaces for leading zeros 
    1863 03D9  BE 0058 R                        MOV     SI,OFFSET DG:FAT + 8 
    1864 03DC  BF 0000 E                        MOV     DI,OFFSET DG:VNAME 
    1865 03DF  B9 000B                          MOV     CX,11 
    1866 03E2  F3/ A4                           REP     MOVSB 
    1867 03E4  BA 0000 E                        MOV     DX,OFFSET DG:IDMES1 
    1868 03E7  E8 05F5 R                        CALL    PRINT                  
					 ;Print ID message 
    1869 03EA  83 C6 0D                         ADD     SI,13 
    1870 03ED  AD                               LODSW                          
					 ;Get date 
    1871 03EE  56                               PUSH    SI 
    1872 03EF  8B D0                            MOV     DX,AX 
    1873 03F1  A1 0030 R                        MOV     AX,[INTERNATVARS.Date_t
					im_format] 
    1874 03F4  0B C0                            OR      AX,AX 
    1875 03F6  74 18                            JZ      USPDAT 
    1876 03F8  48                               DEC     AX 
    1877 03F9  74 30                            JZ      EUPDAT 
    1878 03FB  E8 04A1 R                        CALL    P_YR 
    1879 03FE  E8 043D R                        CALL    P_DSEP 
    1880 0401  E8 0476 R                        CALL    P_MON 
    1881 0404  E8 043D R                        CALL    P_DSEP 
    1882 0407  B9 1000                          MOV     CX,1000H               
					 ;Do not supress leading zeroes 
    1883 040A  E8 048E R                        CALL    P_DAY 
    1884 040D  E9 04BB R                        JMP     P_TIME 
    1885                                 
    1886 0410                           USPDAT: 
    1887 0410  E8 0447 R                        CALL    P_MONTH_NAM 
    1888 0413  B9 1110                          MOV     CX,1110H               
					 ;Supress at most 1 leading 0 
    1889 0416  E8 048E R                        CALL    P_DAY 
    1890 0419  52                               PUSH    DX 
    1891 041A  B2 2C                            MOV     DL,',' 
    1892 041C  E8 05DE R                        CALL    PRTCHR 
    1893 041F  B2 20                            MOV     DL,' ' 
    1894 0421  E8 05DE R                        CALL    PRTCHR 
    1895 0424  5A                               POP     DX 
    1896 0425                           PYA: 
    1897 0425  E8 04A1 R                        CALL    P_YR 
    1898 0428  E9 04BB R                        JMP     P_TIME 
    1899                                 
    1900 042B                           EUPDAT: 
    1901 042B  B9 1110                          MOV     CX,1110H               
					 ;Supress at most 1 leading 0 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-76
PRINTID - Print Volume ID info                              

    1902 042E  E8 048E R                        CALL    P_DAY 
    1903 0431  52                               PUSH    DX 
    1904 0432  B2 20                            MOV     DL,' ' 
    1905 0434  E8 05DE R                        CALL    PRTCHR 
    1906 0437  5A                               POP     DX 
    1907 0438  E8 0447 R                        CALL    P_MONTH_NAM 
    1908 043B  EB E8                            JMP     PYA 
    1909                                 
    1910 043D                           P_DSEP: 
    1911 043D  52                               PUSH    DX 
    1912 043E  8A 16 003B R                     MOV     DL,[INTERNATVARS.Date_s
					ep] 
    1913 0442  E8 05DE R                        CALL    PRTCHR 
    1914 0445  5A                               POP     DX 
    1915 0446  C3                               RET 
    1916                                 
    1917 0447                           P_MONTH_NAM: 
    1918 0447  8B C2                            MOV     AX,DX 
    1919 0449  52                               PUSH    DX 
    1920 044A  B1 05                            MOV     CL,5 
    1921 044C  D3 E8                            SHR     AX,CL 
    1922 044E  25 000F                          AND     AX,0FH                 
					 ;Month in AX 
    1923 0451  48                               DEC     AX                     
					 ;Make 0 indexed 
    1924 0452  8B C8                            MOV     CX,AX 
    1925 0454  D1 E0                            SHL     AX,1 
    1926 0456  03 C1                            ADD     AX,CX                  
					 ;Mult by 3 chars/mo 
    1927 0458  BE 0000 E                        MOV     SI,OFFSET DG:MONTAB 
    1928 045B  03 F0                            ADD     SI,AX 
    1929 045D  AC                               LODSB 
    1930 045E  8A D0                            MOV     DL,AL 
    1931 0460  E8 05DE R                        CALL    PRTCHR 
    1932 0463  AC                               LODSB 
    1933 0464  8A D0                            MOV     DL,AL 
    1934 0466  E8 05DE R                        CALL    PRTCHR 
    1935 0469  AC                               LODSB 
    1936 046A  8A D0                            MOV     DL,AL 
    1937 046C  E8 05DE R                        CALL    PRTCHR 
    1938 046F  B2 20                            MOV     DL,' ' 
    1939 0471  E8 05DE R                        CALL    PRTCHR 
    1940 0474  5A                               POP     DX 
    1941 0475  C3                               RET 
    1942                                 
    1943 0476                           P_MON: 
    1944 0476  8B F2                            MOV     SI,DX 
    1945 0478  52                               PUSH    DX 
    1946 0479  B1 05                            MOV     CL,5 
    1947 047B  D3 EE                            SHR     SI,CL 
    1948 047D  81 E6 000F                       AND     SI,0FH                 
					 ;Month in SI 
    1949 0481  E8 052F R                        CALL    CONVERT 
    1950 0484  8A D0                            MOV     DL,AL 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-77
PRINTID - Print Volume ID info                              

    1951 0486  B9 1000                          MOV     CX,1000H               
					 ;Do not supress leading 0 
    1952 0489  E8 05B3 R                        CALL    OUTBYTE                
					 ;Print month 
    1953 048C  5A                               POP     DX 
    1954 048D  C3                               RET 
    1955                                 
    1956 048E                           P_DAY: 
    1957 048E  8B F2                            MOV     SI,DX 
    1958 0490  52                               PUSH    DX 
    1959 0491  51                               PUSH    CX 
    1960 0492  81 E6 001F                       AND     SI,01FH                
					 ;SI has day 
    1961 0496  E8 052F R                        CALL    CONVERT 
    1962 0499  59                               POP     CX 
    1963 049A  8A D0                            MOV     DL,AL 
    1964 049C  E8 05B3 R                        CALL    OUTBYTE                
					 ;Print day 
    1965 049F  5A                               POP     DX 
    1966 04A0  C3                               RET 
    1967                                 
    1968 04A1                           P_YR: 
    1969 04A1  8B F2                            MOV     SI,DX 
    1970 04A3  52                               PUSH    DX 
    1971 04A4  B1 09                            MOV     CL,9 
    1972 04A6  D3 EE                            SHR     SI,CL 
    1973 04A8  81 E6 007F                       AND     SI,07FH                
					 ;SI has raw year 
    1974 04AC  81 C6 07BC                       ADD     SI,1980                
					 ;Real year 
    1975 04B0  E8 052F R                        CALL    CONVERT 
    1976 04B3  B9 1000                          MOV     CX,1000H               
					 ;Do not supress leading zeros 
    1977 04B6  E8 05AC R                        CALL    OUTWORD                
					 ;Print year 
    1978 04B9  5A                               POP     DX 
    1979 04BA  C3                               RET 
    1980                                 
    1981 04BB                           P_TIME: 
    1982 04BB  B2 20                            MOV     DL,' ' 
    1983 04BD  E8 05DE R                        CALL    PRTCHR 
    1984 04C0  5E                               POP     SI 
    1985 04C1  83 C6 FC                         ADD     SI,-4 
    1986 04C4  AD                               LODSW                          
					 ;Get time 
    1987 04C5  8B F8                            MOV     DI,AX 
    1988 04C7  8B F7                            MOV     SI,DI 
    1989 04C9  B1 0B                            MOV     CL,11 
    1990 04CB  D3 EE                            SHR     SI,CL 
    1991 04CD  81 E6 001F                       AND     SI,01FH                
					 ;SI has hour 
    1992 04D1  80 3E 0041 R 00                  CMP     [INTERNATVARS.Time_24],
					0 
    1993 04D6  75 16                            JNZ     ISOK2                  
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-78
PRINTID - Print Volume ID info                              

					 ;24 hour time? 
    1994 04D8  83 FE 0C                         CMP     SI,12 
    1995 04DB  72 0A                            JB      ISOK                   
					 ;Is AM 
    1996 04DD  C6 06 0000 E 70                  MOV     [TCHAR],'p' 
    1997 04E2  74 03                            JZ      ISOK                   
					 ;Is 12-1p 
    1998 04E4  83 EE 0C                         SUB     SI,12                  
					 ;Is PM 
    1999 04E7                           ISOK: 
    2000 04E7  0B F6                            OR      SI,SI 
    2001 04E9  75 03                            JNZ     ISOK2 
    2002 04EB  BE 000C                          MOV     SI,12                  
					 ;0 is 12a 
    2003 04EE                           ISOK2: 
    2004 04EE  E8 052F R                        CALL    CONVERT 
    2005 04F1  B9 1110                          MOV     CX,1110H               
					 ;Supress at most 1 leading 0 
    2006 04F4  8A D0                            MOV     DL,AL 
    2007 04F6  E8 05B3 R                        CALL    OUTBYTE                
					 ;Print hour 
    2008 04F9  8A 16 003D R                     MOV     DL,BYTE PTR [INTERNATVA
					RS.Time_sep] 
    2009 04FD  E8 05DE R                        CALL    PRTCHR 
    2010 0500  8B F7                            MOV     SI,DI 
    2011 0502  B1 05                            MOV     CL,5 
    2012 0504  D3 EE                            SHR     SI,CL 
    2013 0506  81 E6 003F                       AND     SI,03FH                
					 ;SI has minute 
    2014 050A  E8 052F R                        CALL    CONVERT 
    2015 050D  B9 1000                          MOV     CX,1000H               
					 ;Do not supress leading zeroes 
    2016 0510  8A D0                            MOV     DL,AL 
    2017 0512  E8 05B3 R                        CALL    OUTBYTE                
					 ;Print minute 
    2018 0515  8A 16 0000 E                     MOV     DL,[TCHAR] 
    2019 0519  80 3E 0041 R 00                  CMP     [INTERNATVARS.Time_24],
					0 
    2020 051E  75 03                            JNZ     NOAP                   
					 ;24 hour time, no a or p 
    2021 0520  E8 05DE R                        CALL    PRTCHR                 
					 ;Print a or p 
    2022 0523                           NOAP: 
    2023 0523  BA 0000 E                        MOV     DX,OFFSET DG:IDPOST 
    2024 0526  E8 05F5 R                        CALL    PRINT 
    2025 0529  C6 06 00B5 R 00                  MOV     [DISPFLG],0 
    2026 052E  C3                               RET 
    2027                                 
    2028 052F                           CONVERT: 
    2029 052F  B9 0010                          MOV     CX,16 
    2030 0532  33 C0                            XOR     AX,AX 
    2031 0534                           CNVLOOP: 
    2032 0534  D1 E6                            SHL     SI,1 
    2033 0536  E8 053D R                        CALL    CONVWRD 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-79
PRINTID - Print Volume ID info                              

    2034 0539  F8                               CLC 
    2035 053A  E2 F8                            LOOP    CNVLOOP 
    2036 053C  C3                               RET 
    2037                                 
    2038                                SUBTTL  Misc Routines - Mostly I/O 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-80
Misc Routines - Mostly I/O                                  

    2039                                PAGE 
    2040 053D                           CONVWRD: 
    2041 053D  12 C0                            ADC     AL,AL 
    2042 053F  27                               DAA 
    2043 0540  86 C4                            XCHG    AL,AH 
    2044 0542  12 C0                            ADC     AL,AL 
    2045 0544  27                               DAA 
    2046 0545  86 C4                            XCHG    AL,AH 
    2047 0547  C3                       RET1:   RET 
    2048                                 
    2049 0548                           UNSCALE: 
    2050 0548  D1 E9                            SHR     CX,1 
    2051 054A  72 FB                            JC      RET1 
    2052 054C  D1 E6                            SHL     SI,1 
    2053 054E  D1 D7                            RCL     DI,1 
    2054 0550  EB F6                            JMP     SHORT UNSCALE 
    2055                                 
    2056 0552                           DISP16BITS: 
    2057 0552  C6 06 00B5 R 01                  MOV     BYTE PTR DISPFLG,1 
    2058 0557  EB 11                            JMP     SHORT DISP32BITS 
    2059                                 
    2060 0559                           DISPCLUS: 
    2061 0559  F7 26 000E R                     MUL     [SSIZE] 
    2062 055D  8A 0E 000D R                     MOV     CL,[CSIZE] 
    2063 0561  32 ED                            XOR     CH,CH 
    2064 0563  8B F0                            MOV     SI,AX 
    2065 0565  8B FA                            MOV     DI,DX 
    2066 0567  E8 0548 R                        CALL    UNSCALE 
    2067                                 
    2068 056A                           DISP32BITS: 
    2069 056A  55                               PUSH    BP 
    2070 056B  53                               PUSH    BX 
    2071 056C  33 C0                            XOR     AX,AX 
    2072 056E  8B D8                            MOV     BX,AX 
    2073 0570  8B E8                            MOV     BP,AX 
    2074 0572  B9 0020                          MOV     CX,32 
    2075 0575                           CONVLP: 
    2076 0575  D1 E6                            SHL     SI,1 
    2077 0577  D1 D7                            RCL     DI,1 
    2078 0579  95                               XCHG    AX,BP 
    2079 057A  E8 053D R                        CALL    CONVWRD 
    2080 057D  95                               XCHG    AX,BP 
    2081 057E  93                               XCHG    AX,BX 
    2082 057F  E8 053D R                        CALL    CONVWRD 
    2083 0582  93                               XCHG    AX,BX 
    2084 0583  14 00                            ADC     AL,0 
    2085 0585  E2 EE                            LOOP    CONVLP 
    2086                                        ; Conversion complete 
    2087 0587  B9 1310                          MOV     CX,1310H        ;Print 
					3-digit number with 2 leading blanks 
    2088 058A  80 3E 00B5 R 00                  CMP     BYTE PTR DISPFLG,0 
    2089 058F  75 0B                            JNZ     FOURDIG 
    2090 0591  B9 1810                          MOV     CX,1810H        ;Print 
					8-digit number with 2 leading blanks 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-81
Misc Routines - Mostly I/O                                  

    2091 0594  92                               XCHG    DX,AX 
    2092 0595  E8 05C2 R                        CALL    DIGIT 
    2093 0598  93                               XCHG    AX,BX 
    2094 0599  E8 05AC R                        CALL    OUTWORD 
    2095 059C                           FOURDIG: 
    2096 059C  8B C5                            MOV     AX,BP 
    2097 059E  E8 05AC R                        CALL    OUTWORD 
    2098 05A1  C6 06 00B5 R 00                  MOV     BYTE PTR DISPFLG,0 
    2099 05A6  5A                               POP     DX 
    2100 05A7  E8 05F5 R                        CALL    PRINT 
    2101 05AA  5D                               POP     BP 
    2102 05AB  C3                               RET 
    2103                                 
    2104 05AC                           OUTWORD: 
    2105 05AC  50                               PUSH    AX 
    2106 05AD  8A D4                            MOV     DL,AH 
    2107 05AF  E8 05B3 R                        CALL    OUTBYTE 
    2108 05B2  5A                               POP     DX 
    2109 05B3                           OUTBYTE: 
    2110 05B3  8A F2                            MOV     DH,DL 
    2111 05B5  D0 EA                            SHR     DL,1 
    2112 05B7  D0 EA                            SHR     DL,1 
    2113 05B9  D0 EA                            SHR     DL,1 
    2114 05BB  D0 EA                            SHR     DL,1 
    2115 05BD  E8 05C2 R                        CALL    DIGIT 
    2116 05C0  8A D6                            MOV     DL,DH 
    2117 05C2                           DIGIT: 
    2118 05C2  80 E2 0F                         AND     DL,0FH 
    2119 05C5  74 02                            JZ      BLANKZER 
    2120 05C7  B1 00                            MOV     CL,0 
    2121 05C9                           BLANKZER: 
    2122 05C9  FE CD                            DEC     CH 
    2123 05CB  22 CD                            AND     CL,CH 
    2124 05CD  80 CA 30                         OR      DL,30H 
    2125 05D0  2A D1                            SUB     DL,CL 
    2126 05D2  80 3E 00B5 R 00                  CMP     BYTE PTR DISPFLG,0 
    2127 05D7  74 05                            JZ      PRTCHR 
    2128 05D9  80 FA 30                         CMP     DL,30H 
    2129 05DC  7C 04                            JL      RET2 
    2130 05DE                           PRTCHR: 
    2131 05DE  B4 02                            MOV     AH,STD_CON_OUTPUT 
    2132 05E0  CD 21                            INT     21H 
    2133 05E2  C3                       RET2:   RET 
    2134                                 
    2135 05E3                           PRINTCNT: 
    2136 05E3  AC                               LODSB 
    2137 05E4  8A D0                            MOV     DL,AL 
    2138 05E6  CD 21                            INT     21H 
    2139 05E8  E2 F9                            LOOP    PRINTCNT 
    2140 05EA  C3                               RET 
    2141                                 
    2142 05EB                           EPRINT: 
    2143 05EB  E8 0000 E                        CALL    CHECKERR 
    2144 05EE  75 09                            JNZ     RET$1 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-82
Misc Routines - Mostly I/O                                  

    2145 05F0  EB 03                            JMP     SHORT PRINT 
    2146                                 
    2147 05F2                           DOCRLF: 
    2148 05F2  BA 0000 E                        MOV     DX,OFFSET DG:CRLF 
    2149 05F5                           PRINT: 
    2150 05F5  B4 09                            MOV     AH,STD_CON_STRING_OUTPU
					T 
    2151 05F7  CD 21                            INT     21H 
    2152 05F9  C3                       RET$1:  RET 
    2153                                 
    2154 05FA                           DOTCOMBMES: 
    2155 05FA  80 3E 00BB R 00                  CMP     [NOISY],0 
    2156 05FF  74 12                            JZ      SUBERRP 
    2157 0601  52                               PUSH    DX 
    2158 0602  E8 0000 E                        CALL    PRINTCURRDIRERR 
    2159 0605  BA 0000 E                        MOV     DX,OFFSET DG:CENTRY 
    2160 0608  E8 05EB R                        CALL    EPRINT 
    2161 060B  5A                               POP     DX 
    2162 060C  E8 05EB R                        CALL    EPRINT 
    2163 060F  E8 05F2 R                        CALL    DOCRLF 
    2164 0612  C3                               RET 
    2165                                 
    2166 0613                           SUBERRP: 
    2167 0613  B0 01                            MOV     AL,1 
    2168 0615  86 06 009D R                     XCHG    AL,BYTE PTR [ERRSUB] 
    2169 0619  3C 00                            CMP     AL,0 
    2170 061B  75 0C                            JNZ     RET32 
    2171 061D  BE 007F R                        MOV     SI,OFFSET DG:NUL 
    2172 0620  E8 0000 E                        CALL    PRINTCURRDIRERR 
    2173 0623  BA 0000 E                        MOV     DX,OFFSET DG:BADSUBDIR 
    2174 0626  E8 05EB R                        CALL    EPRINT 
    2175 0629  C3                       RET32:  RET 
    2176                                 
    2177                                 
    2178 062A                           FCB_TO_ASCZ:                           
					 ;Convert DS:SI to ASCIIZ ES:DI 
    2179 062A  B9 0008                          MOV     CX,8 
    2180 062D                           MAINNAME: 
    2181 062D  AC                               LODSB 
    2182 062E  3C 20                            CMP     AL,' ' 
    2183 0630  74 01                            JZ      SKIPSPC 
    2184 0632  AA                               STOSB 
    2185 0633                           SKIPSPC: 
    2186 0633  E2 F8                            LOOP    MAINNAME 
    2187 0635  AC                               LODSB 
    2188 0636  3C 20                            CMP     AL,' ' 
    2189 0638  74 12                            JZ      GOTNAME 
    2190 063A  8A E0                            MOV     AH,AL 
    2191 063C  B0 2E                            MOV     AL,'.' 
    2192 063E  AA                               STOSB 
    2193 063F  86 C4                            XCHG    AL,AH 
    2194 0641  AA                               STOSB 
    2195 0642  B1 02                            MOV     CL,2 
    2196 0644                           EXTNAME: 
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Page     1-83
Misc Routines - Mostly I/O                                  

    2197 0644  AC                               LODSB 
    2198 0645  3C 20                            CMP     AL,' ' 
    2199 0647  74 03                            JZ      GOTNAME 
    2200 0649  AA                               STOSB 
    2201 064A  E2 F8                            LOOP    EXTNAME 
    2202                                 
    2203 064C                           GOTNAME: 
    2204 064C  32 C0                            XOR     AL,AL 
    2205 064E  AA                               STOSB 
    2206 064F  C3                               RET 
    2207                                 
    2208 0650                           CODE    ENDS 
    2209                                        END     CHKDSK 

Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-1
                                                             

Macros:

		N a m e			Lines

BREAK  . . . . . . . . . . . . .  	   2
CONDRET  . . . . . . . . . . . .  	  19
CONTEXT  . . . . . . . . . . . .  	   3
DO_EXT . . . . . . . . . . . . .  	   0
ENTRY  . . . . . . . . . . . . .  	   2
ERROR  . . . . . . . . . . . . .  	   4
INVOKE . . . . . . . . . . . . .  	   8
I_AM . . . . . . . . . . . . . .  	  14
I_NEED . . . . . . . . . . . . .  	  11
JUMP . . . . . . . . . . . . . .  	  17
LONG_ADDR  . . . . . . . . . . .  	   7
MAKELAB  . . . . . . . . . . . .  	   4
PROCEDURE  . . . . . . . . . . .  	   2
RETC . . . . . . . . . . . . . .  	   1
RETNC  . . . . . . . . . . . . .  	   1
RETNZ  . . . . . . . . . . . . .  	   1
RETURN . . . . . . . . . . . . .  	   5
RETZ . . . . . . . . . . . . . .  	   1
SHORT_ADDR . . . . . . . . . . .  	  12
TRANSFER . . . . . . . . . . . .  	   8

Structures and Records:

                N a m e                 Width   # fields
                                        Shift   Width   Mask    Initial

ARENA  . . . . . . . . . . . . .  	0005	0003
  ARENA_SIGNATURE  . . . . . . .  	0000
  ARENA_OWNER  . . . . . . . . .  	0001
  ARENA_SIZE . . . . . . . . . .  	0003
BPBLOCK  . . . . . . . . . . . .  	000D	0008
  BPSECSZ  . . . . . . . . . . .  	0000
  BPCLUS . . . . . . . . . . . .  	0002
  BPRES  . . . . . . . . . . . .  	0003
  BPFTCNT  . . . . . . . . . . .  	0005
  BPDRCNT  . . . . . . . . . . .  	0006
  BPSCCNT  . . . . . . . . . . .  	0008
  BPMEDIA  . . . . . . . . . . .  	000A
  BPFTSEC  . . . . . . . . . . .  	000B
BUFFINFO . . . . . . . . . . . .  	0010	0009
  NEXTBUF  . . . . . . . . . . .  	0000
  BUFDRV . . . . . . . . . . . .  	0004
  BUFDIRTY . . . . . . . . . . .  	0005
  BUFPRI . . . . . . . . . . . .  	0006
  VISIT  . . . . . . . . . . . .  	0007
  BUFSECNO . . . . . . . . . . .  	0008
  BUFWRTCNT  . . . . . . . . . .  	000A
  BUFWRTINC  . . . . . . . . . .  	000B
  BUFDRVDP . . . . . . . . . . .  	000C
DIR_ENTRY  . . . . . . . . . . .  	0020	0008
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-2
                                                             

  DIR_NAME . . . . . . . . . . .  	0000
  DIR_ATTR . . . . . . . . . . .  	000B
  DIR_PAD  . . . . . . . . . . .  	000C
  DIR_TIME . . . . . . . . . . .  	0016
  DIR_DATE . . . . . . . . . . .  	0018
  DIR_FIRST  . . . . . . . . . .  	001A
  DIR_SIZE_L . . . . . . . . . .  	001C
  DIR_SIZE_H . . . . . . . . . .  	001E
DPB  . . . . . . . . . . . . . .  	005E	0012
  DPB_DRIVE  . . . . . . . . . .  	0000
  DPB_UNIT . . . . . . . . . . .  	0001
  DPB_SECTOR_SIZE  . . . . . . .  	0002
  DPB_CLUSTER_MASK . . . . . . .  	0004
  DPB_CLUSTER_SHIFT  . . . . . .  	0005
  DPB_FIRST_FAT  . . . . . . . .  	0006
  DPB_FAT_COUNT  . . . . . . . .  	0008
  DPB_ROOT_ENTRIES . . . . . . .  	0009
  DPB_FIRST_SECTOR . . . . . . .  	000B
  DPB_MAX_CLUSTER  . . . . . . .  	000D
  DPB_FAT_SIZE . . . . . . . . .  	000F
  DPB_DIR_SECTOR . . . . . . . .  	0010
  DPB_DRIVER_ADDR  . . . . . . .  	0012
  DPB_MEDIA  . . . . . . . . . .  	0016
  DPB_FIRST_ACCESS . . . . . . .  	0017
  DPB_NEXT_DPB . . . . . . . . .  	0018
  DPB_CURRENT_DIR  . . . . . . .  	001C
  DPB_DIR_TEXT . . . . . . . . .  	001E
EXEC0  . . . . . . . . . . . . .  	000E	0004
  EXEC0_ENVIRON  . . . . . . . .  	0000
  EXEC0_COM_LINE . . . . . . . .  	0002
  EXEC0_5C_FCB . . . . . . . . .  	0006
  EXEC0_6C_FCB . . . . . . . . .  	000A
EXEC1  . . . . . . . . . . . . .  	0016	0008
  EXEC1_ENVIRON  . . . . . . . .  	0000
  EXEC1_COM_LINE . . . . . . . .  	0002
  EXEC1_5C_FCB . . . . . . . . .  	0006
  EXEC1_6C_FCB . . . . . . . . .  	000A
  EXEC1_SP . . . . . . . . . . .  	000E
  EXEC1_SS . . . . . . . . . . .  	0010
  EXEC1_IP . . . . . . . . . . .  	0012
  EXEC1_CS . . . . . . . . . . .  	0014
EXEC3  . . . . . . . . . . . . .  	0004	0002
  EXEC3_LOAD_ADDR  . . . . . . .  	0000
  EXEC3_RELOC_FAC  . . . . . . .  	0002
EXE_FILE . . . . . . . . . . . .  	0020	000F
  EXE_SIGNATURE  . . . . . . . .  	0000
  EXE_LEN_MOD_512  . . . . . . .  	0002
  EXE_PAGES  . . . . . . . . . .  	0004
  EXE_RLE_COUNT  . . . . . . . .  	0006
  EXE_PAR_DIR  . . . . . . . . .  	0008
  EXE_MIN_BSS  . . . . . . . . .  	000A
  EXE_MAX_BSS  . . . . . . . . .  	000C
  EXE_SS . . . . . . . . . . . .  	000E
  EXE_SP . . . . . . . . . . . .  	0010
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-3
                                                             

  EXE_CHKSUM . . . . . . . . . .  	0012
  EXE_IP . . . . . . . . . . . .  	0014
  EXE_CS . . . . . . . . . . . .  	0016
  EXE_RLE_TABLE  . . . . . . . .  	0018
  EXE_IOV  . . . . . . . . . . .  	001A
  EXE_SYM_TAB  . . . . . . . . .  	001C
FIND_BUF . . . . . . . . . . . .  	002B	000C
  FIND_BUF_SATTR . . . . . . . .  	0000
  FIND_BUF_DRIVE . . . . . . . .  	0001
  FIND_BUF_NAME  . . . . . . . .  	0002
  FIND_BUF_LASTENT . . . . . . .  	000D
  FIND_BUF_THISDPB . . . . . . .  	000F
  FIND_BUF_DIRSTART  . . . . . .  	0013
  FIND_BUF_ATTR  . . . . . . . .  	0015
  FIND_BUF_TIME  . . . . . . . .  	0016
  FIND_BUF_DATE  . . . . . . . .  	0018
  FIND_BUF_SIZE_L  . . . . . . .  	001A
  FIND_BUF_SIZE_H  . . . . . . .  	001C
  FIND_BUF_PNAME . . . . . . . .  	001E
INTERNAT_BLOCK . . . . . . . . .  	0018	0015
  DATE_TIM_FORMAT  . . . . . . .  	0000
  CURRENCY_SYM . . . . . . . . .  	0002
  THOUS_SEP  . . . . . . . . . .  	0007
  DECIMAL_SEP  . . . . . . . . .  	0009
  DATE_SEP . . . . . . . . . . .  	000B
  TIME_SEP . . . . . . . . . . .  	000D
  BIT_FEILD  . . . . . . . . . .  	000F
  CURRENCY_CENTS . . . . . . . .  	0010
  TIME_24  . . . . . . . . . . .  	0011
  MAP_CALL . . . . . . . . . . .  	0012
  DATA_SEP . . . . . . . . . . .  	0016
PROCESS_DATA_BLOCK . . . . . . .  	005B	000E
  PDB_EXIT_CALL  . . . . . . . .  	0000
  PDB_BLOCK_LEN  . . . . . . . .  	0002
  PDB_CPM_CALL . . . . . . . . .  	0005
  PDB_EXIT . . . . . . . . . . .  	000A
  PDB_CTRL_C . . . . . . . . . .  	000E
  PDB_FATAL_ABORT  . . . . . . .  	0012
  PDB_PARENT_PID . . . . . . . .  	0016
  PDB_JFN_TABLE  . . . . . . . .  	0018
  PDB_ENVIRON  . . . . . . . . .  	002C
  PDB_USER_STACK . . . . . . . .  	002E
  PDB_PAD1 . . . . . . . . . . .  	0032
  PDB_CALL_SYSTEM  . . . . . . .  	0050
  PDB_PAD2 . . . . . . . . . . .  	0055
SFT  . . . . . . . . . . . . . .  	0008	0003
  SFT_LINK . . . . . . . . . . .  	0000
  SFT_COUNT  . . . . . . . . . .  	0004
  SFT_TABLE  . . . . . . . . . .  	0006
SF_ENTRY . . . . . . . . . . . .  	0028	0004
  SF_REF_COUNT . . . . . . . . .  	0000
  SF_MODE  . . . . . . . . . . .  	0001
  SF_ATTR  . . . . . . . . . . .  	0002
  SF_FCB . . . . . . . . . . . .  	0003
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-4
                                                             

SYMBOL_ENTRY . . . . . . . . . .  	0106	0004
  SYM_VALUE  . . . . . . . . . .  	0000
  SYM_TYPE . . . . . . . . . . .  	0004
  SYM_LEN  . . . . . . . . . . .  	0006
  SYM_NAME . . . . . . . . . . .  	0007
SYS_FCB  . . . . . . . . . . . .  	0025	0010
  FCB_DRIVE  . . . . . . . . . .  	0000
  FCB_NAME . . . . . . . . . . .  	0001
  FCB_EXT  . . . . . . . . . . .  	0009
  FCB_EXTENT . . . . . . . . . .  	000C
  FCB_RECSIZ . . . . . . . . . .  	000E
  FCB_FILSIZ . . . . . . . . . .  	0010
  FCB_DRVBP  . . . . . . . . . .  	0012
  FCB_FDATE  . . . . . . . . . .  	0014
  FCB_FTIME  . . . . . . . . . .  	0016
  FCB_DEVID  . . . . . . . . . .  	0018
  FCB_FIRCLUS  . . . . . . . . .  	0019
  FCB_CLUSPOS  . . . . . . . . .  	001B
  FCB_LSTCLUS  . . . . . . . . .  	001D
  FCB_NR . . . . . . . . . . . .  	0020
  FCB_RR . . . . . . . . . . . .  	0021
USER_ENVIRON . . . . . . . . . .  	0018	000C
  USER_AX  . . . . . . . . . . .  	0000
  USER_BX  . . . . . . . . . . .  	0002
  USER_CX  . . . . . . . . . . .  	0004
  USER_DX  . . . . . . . . . . .  	0006
  USER_SI  . . . . . . . . . . .  	0008
  USER_DI  . . . . . . . . . . .  	000A
  USER_BP  . . . . . . . . . . .  	000C
  USER_DS  . . . . . . . . . . .  	000E
  USER_ES  . . . . . . . . . . .  	0010
  USER_IP  . . . . . . . . . . .  	0012
  USER_CS  . . . . . . . . . . .  	0014
  USER_F . . . . . . . . . . . .  	0016

Segments and Groups:

                N a m e         	Size	Align	Combine Class

DG . . . . . . . . . . . . . . .  	GROUP
  CODE . . . . . . . . . . . . .  	0650	PARA	PUBLIC	
  CONST  . . . . . . . . . . . .  	010E	BYTE	PUBLIC	
  DATA . . . . . . . . . . . . .  	0050	WORD	PUBLIC	

Symbols:            

                N a m e         	Type	Value	Attr         

ABORT  . . . . . . . . . . . . .  	Number	0000	
ADDR_INT_ABORT . . . . . . . . .  	Number	0080	
ADDR_INT_COMMAND . . . . . . . .  	Number	0084	
ADDR_INT_CTRL_C  . . . . . . . .  	Number	008C	
ADDR_INT_DISK_READ . . . . . . .  	Number	0094	
ADDR_INT_DISK_WRITE  . . . . . .  	Number	0098	
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-5
                                                             

ADDR_INT_FASTCON . . . . . . . .  	Number	00A4	
ADDR_INT_FATAL_ABORT . . . . . .  	Number	0090	
ADDR_INT_KEEP_PROCESS  . . . . .  	Number	009C	
ADDR_INT_SPOOLER . . . . . . . .  	Number	00A0	
ADDR_INT_TERMINATE . . . . . . .  	Number	0088	
ALLDONE  . . . . . . . . . . . .  	L NEAR	0317	CODE
ALLDRV . . . . . . . . . . . . .  	L BYTE 	0033	CONST	Global
ALLFILE  . . . . . . . . . . . .  	L BYTE 	002C	CONST	Global
ALLOC  . . . . . . . . . . . . .  	Number	0048	
ALLOCOPER  . . . . . . . . . . .  	Number	0058	
ALLOC_ARENA_TRASHED  . . . . . .  	Alias	 ERROR_ARENA_TRASHED		
ALLOC_NOT_ENOUGH_MEMORY  . . . .  	Alias	 ERROR_NOT_ENOUGH_MEMORY		
ALTVECT  . . . . . . . . . . . .  	Number	0000	
AMDONE . . . . . . . . . . . . .  	L NEAR	0000	CODE	External
ARENA_OWNER_SYSTEM . . . . . . .  	Number	0000	
ARENA_SIGNATURE_END  . . . . . .  	Number	005A	
ARENA_SIGNATURE_NORMAL . . . . .  	Number	004D	
ASSIGNOPER . . . . . . . . . . .  	Number	005F	
ATTR_ALL . . . . . . . . . . . .  	Number	0016	
ATTR_ARCHIVE . . . . . . . . . .  	Number	0020	
ATTR_CHANGEABLE  . . . . . . . .  	Number	0027	
ATTR_DIRECTORY . . . . . . . . .  	Number	0010	
ATTR_HIDDEN  . . . . . . . . . .  	Number	0002	
ATTR_IGNORE  . . . . . . . . . .  	Number	0021	
ATTR_READ_ONLY . . . . . . . . .  	Number	0001	
ATTR_SYSTEM  . . . . . . . . . .  	Number	0004	
ATTR_VOLUME_ID . . . . . . . . .  	Number	0008	

BADCD  . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
BADDRV . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
BADDRVM  . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
BADDRVM2 . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
BADIDBYT . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
BADRDMES . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
BADREAD_POST . . . . . . . . . .  	V BYTE 	0000	CONST	External
BADREAD_PRE  . . . . . . . . . .  	V BYTE 	0000	CONST	External
BADSIZ . . . . . . . . . . . . .  	L WORD 	00AD	CONST	Global
BADSUBDIR  . . . . . . . . . . .  	V BYTE 	0000	CONST	External
BADVER . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
BLANKZER . . . . . . . . . . . .  	L NEAR	05C9	CODE
BUFINSIZ . . . . . . . . . . . .  	Number	0010	

CDONE  . . . . . . . . . . . . .  	L NEAR	03B6	CODE
CENTRY . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
CERROR . . . . . . . . . . . . .  	L NEAR	0151	CODE
CERROR2  . . . . . . . . . . . .  	L NEAR	0158	CODE
CERROR2J . . . . . . . . . . . .  	L NEAR	01C9	CODE
CHAR_OPER  . . . . . . . . . . .  	Number	0037	
CHDIR  . . . . . . . . . . . . .  	Number	003B	
CHDIR_PATH_NOT_FOUND . . . . . .  	Alias	 ERROR_PATH_NOT_FOUND		
CHECKERR . . . . . . . . . . . .  	L NEAR	0000	CODE	External
CHECKFILES . . . . . . . . . . .  	L NEAR	031C	CODE	Global
CHKCROSS . . . . . . . . . . . .  	L NEAR	0000	CODE	External
CHKDSK . . . . . . . . . . . . .  	L NEAR	0100	CODE
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-6
                                                             

CHKMAP . . . . . . . . . . . . .  	L NEAR	0000	CODE	External
CHMOD  . . . . . . . . . . . . .  	Number	0043	
CHMOD_ACCESS_DENIED  . . . . . .  	Alias	 ERROR_ACCESS_DENIED		
CHMOD_INVALID_FUNCTION . . . . .  	Alias	 ERROR_INVALID_FUNCTION		
CHMOD_PATH_NOT_FOUND . . . . . .  	Alias	 ERROR_PATH_NOT_FOUND		
CHSTRT . . . . . . . . . . . . .  	L NEAR	010A	CODE
CLOSE  . . . . . . . . . . . . .  	Number	003E	
CLOSE_INVALID_FUNCTION . . . . .  	Alias	 ERROR_INVALID_FUNCTION		
CLOSE_INVALID_HANDLE . . . . . .  	Alias	 ERROR_INVALID_HANDLE		
CNVLOOP  . . . . . . . . . . . .  	L NEAR	0534	CODE
CONBUF . . . . . . . . . . . . .  	L BYTE 	00FD	CONST	Global
CONTAINS . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
CONTCH . . . . . . . . . . . . .  	L DWORD	0004	DATA	Global
CONVERT  . . . . . . . . . . . .  	L NEAR	052F	CODE
CONVLP . . . . . . . . . . . . .  	L NEAR	0575	CODE
CONVWRD  . . . . . . . . . . . .  	L NEAR	053D	CODE
COUNTRY_NOT_FOUND  . . . . . . .  	Alias	 ERROR_FILE_NOT_FOUND		
CREAT  . . . . . . . . . . . . .  	Number	003C	
CREATENEWFILE  . . . . . . . . .  	Number	005B	
CREATETEMPFILE . . . . . . . . .  	Number	005A	
CREATE_PROCESS_DATA_BLOCK  . . .  	Number	0026	
CREAT_ACCESS_DENIED  . . . . . .  	Alias	 ERROR_ACCESS_DENIED		
CREAT_PATH_NOT_FOUND . . . . . .  	Alias	 ERROR_PATH_NOT_FOUND		
CREAT_TOO_MANY_OPEN_FILES  . . .  	Alias	 ERROR_TOO_MANY_OPEN_FILES		
CRLF . . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
CROSSCNT . . . . . . . . . . . .  	L WORD 	00B6	CONST	Global
CSIZE  . . . . . . . . . . . . .  	L BYTE 	000D	DATA	Global
CURDIR_INVALID_DRIVE . . . . . .  	Alias	 ERROR_INVALID_DRIVE		
CURRENT_DIR  . . . . . . . . . .  	Number	0047	
CURRISROOT . . . . . . . . . . .  	L NEAR	01E7	CODE
C_BS . . . . . . . . . . . . . .  	Number	0008	
C_CR . . . . . . . . . . . . . .  	Number	000D	
C_DEL  . . . . . . . . . . . . .  	Number	007F	
C_ETB  . . . . . . . . . . . . .  	Number	0017	
C_ETX  . . . . . . . . . . . . .  	Number	0003	
C_HT . . . . . . . . . . . . . .  	Number	0009	
C_LF . . . . . . . . . . . . . .  	Number	000A	
C_NAK  . . . . . . . . . . . . .  	Number	0015	

DDOTENT  . . . . . . . . . . . .  	L BYTE 	0090	CONST	Global
DEALLOC  . . . . . . . . . . . .  	Number	0049	
DEALLOC_ARENA_TRASHED  . . . . .  	Alias	 ERROR_ARENA_TRASHED		
DEALLOC_INVALID_BLOCK  . . . . .  	Alias	 ERROR_INVALID_BLOCK		
DEVID_BLOCK_DEV  . . . . . . . .  	Number	001F	
DEVID_DEVICE . . . . . . . . . .  	Number	0080	
DEVID_DEVICE_CLOCK . . . . . . .  	Number	0008	
DEVID_DEVICE_CON_IN  . . . . . .  	Number	0001	
DEVID_DEVICE_CON_OUT . . . . . .  	Number	0002	
DEVID_DEVICE_EOF . . . . . . . .  	Number	0040	
DEVID_DEVICE_NULL  . . . . . . .  	Number	0004	
DEVID_DEVICE_RAW . . . . . . . .  	Number	0020	
DEVID_DEVICE_SPECIAL . . . . . .  	Number	0010	
DEVID_EOF  . . . . . . . . . . .  	Number	0040	
DEVID_FILE_CLEAN . . . . . . . .  	Number	0040	
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-7
                                                             

DEVID_FILE_MASK_DRIVE  . . . . .  	Number	003F	
DEVID_ISCIN  . . . . . . . . . .  	Number	0001	
DEVID_ISCLK  . . . . . . . . . .  	Number	0008	
DEVID_ISCOT  . . . . . . . . . .  	Number	0002	
DEVID_ISDEV  . . . . . . . . . .  	Number	0080	
DEVID_ISNUL  . . . . . . . . . .  	Number	0004	
DEVID_RAW  . . . . . . . . . . .  	Number	0020	
DEVID_SPECIAL  . . . . . . . . .  	Number	0010	
DIGIT  . . . . . . . . . . . . .  	L NEAR	05C2	CODE
DIRBUF . . . . . . . . . . . . .  	L BYTE 	0000	CONST	Global
DIRCHAR  . . . . . . . . . . . .  	L BYTE 	007E	CONST	Global
DIRCNT . . . . . . . . . . . . .  	L WORD 	00A1	CONST	Global
DIRPRI . . . . . . . . . . . . .  	Number	000F	
DIRPROC  . . . . . . . . . . . .  	L NEAR	0000	CODE	External
DIRSIZ . . . . . . . . . . . . .  	L WORD 	00A3	CONST	Global
DIRSTRLEN  . . . . . . . . . . .  	Number	0040	
DIRTYFAT . . . . . . . . . . . .  	L BYTE 	00A0	CONST	Global
DIR_SEARCH_FIRST . . . . . . . .  	Number	0011	
DIR_SEARCH_NEXT  . . . . . . . .  	Number	0012	
DISK_RESET . . . . . . . . . . .  	Number	000D	
DISP16BITS . . . . . . . . . . .  	L NEAR	0552	CODE	Global
DISP32BITS . . . . . . . . . . .  	L NEAR	056A	CODE	Global
DISPCLUS . . . . . . . . . . . .  	L NEAR	0559	CODE	Global
DISPFLG  . . . . . . . . . . . .  	L BYTE 	00B5	CONST
DOCRLF . . . . . . . . . . . . .  	L NEAR	05F2	CODE	Global
DOFIX  . . . . . . . . . . . . .  	L BYTE 	00BA	CONST	Global
DONE . . . . . . . . . . . . . .  	L NEAR	0000	CODE	External
DOSVER_HIGH  . . . . . . . . . .  	Number	020B	
DOSVER_LOW . . . . . . . . . . .  	Number	0136	
DOS_MAJOR_VERSION  . . . . . . .  	Number	0002	
DOS_MINOR_VERSION  . . . . . . .  	Number	000B	
DOTCOMBMES . . . . . . . . . . .  	L NEAR	05FA	CODE	Global
DOTENT . . . . . . . . . . . . .  	L BYTE 	0085	CONST	Global
DOTMES . . . . . . . . . . . . .  	L BYTE 	0083	CONST	Global
DOTSNOGOOD . . . . . . . . . . .  	L BYTE 	0022	DATA	Global
DPBSIZ . . . . . . . . . . . . .  	Number	005E	
DRVCHAR  . . . . . . . . . . . .  	Number	003A	
DRVCHK . . . . . . . . . . . . .  	L NEAR	018C	CODE
DRVERR . . . . . . . . . . . . .  	L NEAR	014E	CODE
DRVISOK  . . . . . . . . . . . .  	L NEAR	01CB	CODE
DSIZE  . . . . . . . . . . . . .  	L WORD 	0010	DATA	Global
DSKSIZ . . . . . . . . . . . . .  	Number	000D	
DUP2_INVALID_HANDLE  . . . . . .  	Alias	 ERROR_INVALID_HANDLE		
DUP_INVALID_HANDLE . . . . . . .  	Alias	 ERROR_INVALID_HANDLE		
DUP_PDB  . . . . . . . . . . . .  	Number	0055	
DUP_TOO_MANY_OPEN_FILES  . . . .  	Alias	 ERROR_TOO_MANY_OPEN_FILES		

EACHCLUS . . . . . . . . . . . .  	L NEAR	034B	CODE
ENTRYPOINT . . . . . . . . . . .  	Number	00C0	
EPRINT . . . . . . . . . . . . .  	L NEAR	05EB	CODE	Global
ERRCNT . . . . . . . . . . . . .  	L BYTE 	002D	DATA	Global
ERROR_ACCESS_DENIED  . . . . . .  	Number	0005	
ERROR_ARENA_TRASHED  . . . . . .  	Number	0007	
ERROR_BAD_ENVIRONMENT  . . . . .  	Number	000A	
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-8
                                                             

ERROR_BAD_FORMAT . . . . . . . .  	Number	000B	
ERROR_CURRENT_DIRECTORY  . . . .  	Number	0010	
ERROR_FILE_NOT_FOUND . . . . . .  	Number	0002	
ERROR_INVALID_ACCESS . . . . . .  	Number	000C	
ERROR_INVALID_BLOCK  . . . . . .  	Number	0009	
ERROR_INVALID_DATA . . . . . . .  	Number	000D	
ERROR_INVALID_DRIVE  . . . . . .  	Number	000F	
ERROR_INVALID_FUNCTION . . . . .  	Number	0001	
ERROR_INVALID_HANDLE . . . . . .  	Number	0006	
ERROR_NOT_ENOUGH_MEMORY  . . . .  	Number	0008	
ERROR_NOT_SAME_DEVICE  . . . . .  	Number	0011	
ERROR_NO_MORE_FILES  . . . . . .  	Number	0012	
ERROR_PATH_NOT_FOUND . . . . . .  	Number	0003	
ERROR_TOO_MANY_OPEN_FILES  . . .  	Number	0004	
ERRSUB . . . . . . . . . . . . .  	L WORD 	009D	CONST	Global
EUPDAT . . . . . . . . . . . . .  	L NEAR	042B	CODE
EXEC . . . . . . . . . . . . . .  	Number	004B	
EXEC_BAD_ENVIRONMENT . . . . . .  	Alias	 ERROR_BAD_ENVIRONMENT		
EXEC_BAD_FORMAT  . . . . . . . .  	Alias	 ERROR_BAD_FORMAT		
EXEC_FILE_NOT_FOUND  . . . . . .  	Alias	 ERROR_FILE_NOT_FOUND		
EXEC_FUNC_NO_EXECUTE . . . . . .  	Number	0001	
EXEC_FUNC_OVERLAY  . . . . . . .  	Number	0002	
EXEC_INVALID_FUNCTION  . . . . .  	Alias	 ERROR_INVALID_FUNCTION		
EXEC_NOT_ENOUGH_MEMORY . . . . .  	Alias	 ERROR_NOT_ENOUGH_MEMORY		
EXE_VALID_OLD_SIGNATURE  . . . .  	Number	4D5A	
EXE_VALID_SIGNATURE  . . . . . .  	Number	5A4D	
EXIT . . . . . . . . . . . . . .  	Number	004C	
EXIT_ABORT . . . . . . . . . . .  	Number	0000	
EXIT_CTRL_C  . . . . . . . . . .  	Number	0001	
EXIT_HARD_ERROR  . . . . . . . .  	Number	0002	
EXIT_KEEP_PROCESS  . . . . . . .  	Number	0003	
EXIT_TERMINATE . . . . . . . . .  	Number	0000	
EXTENTS  . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
EXTNAME  . . . . . . . . . . . .  	L NEAR	0644	CODE

FALSE  . . . . . . . . . . . . .  	Number	0000	
FAT  . . . . . . . . . . . . . .  	L WORD 	0050	DATA	Global
FATAL  . . . . . . . . . . . . .  	L NEAR	0000	CODE	External
FATMAP . . . . . . . . . . . . .  	L WORD 	0029	DATA	Global
FATPRI . . . . . . . . . . . . .  	Number	001E	
FCB  . . . . . . . . . . . . . .  	Number	005C	
FCB_CLOSE  . . . . . . . . . . .  	Number	0010	
FCB_CREATE . . . . . . . . . . .  	Number	0016	
FCB_DELETE . . . . . . . . . . .  	Number	0013	
FCB_OPEN . . . . . . . . . . . .  	Number	000F	
FCB_RANDOM_READ  . . . . . . . .  	Number	0021	
FCB_RANDOM_READ_BLOCK  . . . . .  	Number	0027	
FCB_RANDOM_WRITE . . . . . . . .  	Number	0022	
FCB_RANDOM_WRITE_BLOCK . . . . .  	Number	0028	
FCB_RENAME . . . . . . . . . . .  	Number	0017	
FCB_SEQ_READ . . . . . . . . . .  	Number	0014	
FCB_SEQ_WRITE  . . . . . . . . .  	Number	0015	
FCB_TO_ASCZ  . . . . . . . . . .  	L NEAR	062A	CODE	Global
FIGREC . . . . . . . . . . . . .  	L NEAR	03B7	CODE	Global
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-9
                                                             

FILCNT . . . . . . . . . . . . .  	L WORD 	00A5	CONST	Global
FILDIRENT  . . . . . . . . . . .  	Number	0010	
FILECHK  . . . . . . . . . . . .  	L NEAR	015F	CODE
FILETIMES_INVALID_FUNCTION . . .  	Alias	 ERROR_INVALID_FUNCTION		
FILETIMES_INVALID_HANDLE . . . .  	Alias	 ERROR_INVALID_HANDLE		
FILE_TIMES . . . . . . . . . . .  	Number	0057	
FILPERPROC . . . . . . . . . . .  	Number	0014	
FILSIZ . . . . . . . . . . . . .  	L WORD 	00A7	CONST	Global
FILSPOK  . . . . . . . . . . . .  	L NEAR	03A9	CODE
FINDCHAIN  . . . . . . . . . . .  	L NEAR	0000	CODE	External
FINDFIRST_FILE_NOT_FOUND . . . .  	Alias	 ERROR_FILE_NOT_FOUND		
FINDFIRST_NO_MORE_FILES  . . . .  	Alias	 ERROR_NO_MORE_FILES		
FINDNEXT_NO_MORE_FILES . . . . .  	Alias	 ERROR_NO_MORE_FILES		
FIND_FIRST . . . . . . . . . . .  	Number	004E	
FIND_NEXT  . . . . . . . . . . .  	Number	004F	
FIXMFLG  . . . . . . . . . . . .  	L BYTE 	009C	CONST	Global
FOURDIG  . . . . . . . . . . . .  	L NEAR	059C	CODE
FRAGCHK  . . . . . . . . . . . .  	L NEAR	032E	CODE
FRAGMENT . . . . . . . . . . . .  	L BYTE 	009F	CONST	Global
FREEPRI  . . . . . . . . . . . .  	Number	0000	

GETEXTENDEDERROR . . . . . . . .  	Number	0059	
GETNXT . . . . . . . . . . . . .  	L NEAR	0390	CODE
GET_CURRENT_PDB  . . . . . . . .  	Number	0051	
GET_DATE . . . . . . . . . . . .  	Number	002A	
GET_DEFAULT_DPB  . . . . . . . .  	Number	001F	
GET_DEFAULT_DRIVE  . . . . . . .  	Number	0019	
GET_DMA  . . . . . . . . . . . .  	Number	002F	
GET_DPB  . . . . . . . . . . . .  	Number	0032	
GET_DRIVE_FREESPACE  . . . . . .  	Number	0036	
GET_FCB_FILE_LENGTH  . . . . . .  	Number	0023	
GET_FCB_POSITION . . . . . . . .  	Number	0024	
GET_INDOS_FLAG . . . . . . . . .  	Number	0034	
GET_INTERRUPT_VECTOR . . . . . .  	Number	0035	
GET_IN_VARS  . . . . . . . . . .  	Number	0052	
GET_TIME . . . . . . . . . . . .  	Number	002C	
GET_VERIFY_ON_WRITE  . . . . . .  	Number	0054	
GET_VERSION  . . . . . . . . . .  	Number	0030	
GOTBADDOS  . . . . . . . . . . .  	L NEAR	011B	CODE
GOTNAME  . . . . . . . . . . . .  	L NEAR	064C	CODE

HARDCH . . . . . . . . . . . . .  	L DWORD	0000	DATA	Global
HAVFIX . . . . . . . . . . . . .  	L BYTE 	00B9	CONST	Global
HEADER . . . . . . . . . . . . .  	L BYTE 	0102	CODE
HECODE . . . . . . . . . . . . .  	L BYTE 	009B	CONST	Global
HIDCNT . . . . . . . . . . . . .  	L WORD 	00A9	CONST	Global
HIDSIZ . . . . . . . . . . . . .  	L WORD 	00AB	CONST	Global

IDMES1 . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
IDOK . . . . . . . . . . . . . .  	L NEAR	02F0	CODE
IDPOST . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
INTBASE  . . . . . . . . . . . .  	Number	0080	
INTERNATIONAL  . . . . . . . . .  	Number	0038	
INTERNATIONAL_INVALID_FUNCTION .  	Alias	 ERROR_INVALID_FUNCTION		
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-10
                                                             

INTERNATVARS . . . . . . . . . .  	L 0018	0030	DATA
INTERNAT_BLOCK_MAX . . . . . . .  	Number	0020	
INTTAB . . . . . . . . . . . . .  	Number	0020	
INT_23 . . . . . . . . . . . . .  	L NEAR	0000	CODE	External
INT_24 . . . . . . . . . . . . .  	L NEAR	0000	CODE	External
INT_ABORT  . . . . . . . . . . .  	Alias	 INTTAB		
INT_COMMAND  . . . . . . . . . .  	Number	0021	
INT_CTRL_C . . . . . . . . . . .  	Number	0023	
INT_DISK_READ  . . . . . . . . .  	Number	0025	
INT_DISK_WRITE . . . . . . . . .  	Number	0026	
INT_FASTCON  . . . . . . . . . .  	Number	0029	
INT_FATAL_ABORT  . . . . . . . .  	Number	0024	
INT_KEEP_PROCESS . . . . . . . .  	Number	0027	
INT_SPOOLER  . . . . . . . . . .  	Number	0028	
INT_TERMINATE  . . . . . . . . .  	Number	0022	
IOCTL  . . . . . . . . . . . . .  	Number	0044	
IOCTL_INVALID_DATA . . . . . . .  	Alias	 ERROR_INVALID_DATA		
IOCTL_INVALID_FUNCTION . . . . .  	Alias	 ERROR_INVALID_FUNCTION		
IOCTL_INVALID_HANDLE . . . . . .  	Alias	 ERROR_INVALID_HANDLE		
ISCROSS  . . . . . . . . . . . .  	L BYTE 	0024	DATA	Global
ISOK . . . . . . . . . . . . . .  	L NEAR	04E7	CODE
ISOK2  . . . . . . . . . . . . .  	L NEAR	04EE	CODE

KEEP_PROCESS . . . . . . . . . .  	Number	0031	

LASTCLUS . . . . . . . . . . . .  	L NEAR	0360	CODE
LBRPRI . . . . . . . . . . . . .  	Number	0002	
LBWPRI . . . . . . . . . . . . .  	Number	0004	
LCLUS  . . . . . . . . . . . . .  	L WORD 	00B3	CONST	Global
LOCKOPER . . . . . . . . . . . .  	Number	005C	
LSEEK  . . . . . . . . . . . . .  	Number	0042	
LSEEK_INVALID_FUNCTION . . . . .  	Alias	 ERROR_INVALID_FUNCTION		
LSEEK_INVALID_HANDLE . . . . . .  	Alias	 ERROR_INVALID_HANDLE		

MAINNAME . . . . . . . . . . . .  	L NEAR	062D	CODE
MCLUS  . . . . . . . . . . . . .  	L WORD 	0012	DATA	Global
MI_INT . . . . . . . . . . . . .  	Number	00CD	
MI_LONG_CALL . . . . . . . . . .  	Number	009A	
MI_LONG_JMP  . . . . . . . . . .  	Number	00EA	
MI_LONG_RET  . . . . . . . . . .  	Number	00CB	
MKDIR  . . . . . . . . . . . . .  	Number	0039	
MKDIR_ACCESS_DENIED  . . . . . .  	Alias	 ERROR_ACCESS_DENIED		
MKDIR_PATH_NOT_FOUND . . . . . .  	Alias	 ERROR_PATH_NOT_FOUND		
MONTAB . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
MSGCHK . . . . . . . . . . . . .  	L NEAR	0394	CODE

NAMBUF . . . . . . . . . . . . .  	L BYTE 	0014	DATA	Global	Length = 000E
NOAP . . . . . . . . . . . . . .  	L NEAR	0523	CODE
NOEXTENTS  . . . . . . . . . . .  	V BYTE 	0000	CONST	External
NOISY  . . . . . . . . . . . . .  	L BYTE 	00BB	CONST	Global
NORETRY1 . . . . . . . . . . . .  	L NEAR	02D3	CODE
NOTVOLID . . . . . . . . . . . .  	L NEAR	023F	CODE
NO_ERROR_OCCURRED  . . . . . . .  	Text  0                                                              ?		
NUL  . . . . . . . . . . . . . .  	L BYTE 	007F	CONST	Global
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-11
                                                             

NXTCHK . . . . . . . . . . . . .  	L NEAR	0369	CODE

OEM_C1 . . . . . . . . . . . . .  	Number	00F9	
OEM_C2 . . . . . . . . . . . . .  	Number	00FA	
OEM_C3 . . . . . . . . . . . . .  	Number	00FB	
OEM_C4 . . . . . . . . . . . . .  	Number	00FC	
OEM_C5 . . . . . . . . . . . . .  	Number	00FD	
OEM_C6 . . . . . . . . . . . . .  	Number	00FE	
OEM_C7 . . . . . . . . . . . . .  	Number	00FF	
OKDOS  . . . . . . . . . . . . .  	L NEAR	0121	CODE
OLDCLUS  . . . . . . . . . . . .  	L WORD 	0025	DATA
OPEN . . . . . . . . . . . . . .  	Number	003D	
OPEN_ACCESS_DENIED . . . . . . .  	Alias	 ERROR_ACCESS_DENIED		
OPEN_FILE_NOT_FOUND  . . . . . .  	Alias	 ERROR_FILE_NOT_FOUND		
OPEN_FOR_BOTH  . . . . . . . . .  	Number	0002	
OPEN_FOR_READ  . . . . . . . . .  	Number	0000	
OPEN_FOR_WRITE . . . . . . . . .  	Number	0001	
OPEN_INVALID_ACCESS  . . . . . .  	Alias	 ERROR_INVALID_ACCESS		
OPEN_TOO_MANY_OPEN_FILES . . . .  	Alias	 ERROR_TOO_MANY_OPEN_FILES		
OPNERR . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
ORPHCNT  . . . . . . . . . . . .  	L WORD 	00AF	CONST	Global
ORPHEXT  . . . . . . . . . . . .  	L BYTE 	0061	CONST	Global
ORPHFCB  . . . . . . . . . . . .  	L BYTE 	0058	CONST	Global
ORPHSIZ  . . . . . . . . . . . .  	L WORD 	00B1	CONST	Global
OUTBYTE  . . . . . . . . . . . .  	L NEAR	05B3	CODE
OUTWORD  . . . . . . . . . . . .  	L NEAR	05AC	CODE

PARSE_FILE_DESCRIPTOR  . . . . .  	Number	0029	
PARSTR . . . . . . . . . . . . .  	L BYTE 	0080	CONST	Global
PRINT  . . . . . . . . . . . . .  	L NEAR	05F5	CODE	Global
PRINTCNT . . . . . . . . . . . .  	L NEAR	05E3	CODE
PRINTCURRDIRERR  . . . . . . . .  	L NEAR	0000	CODE	External
PRINTID  . . . . . . . . . . . .  	L NEAR	03CC	CODE
PRINTTHISEL2 . . . . . . . . . .  	L NEAR	0000	CODE	External
PROMPTYN . . . . . . . . . . . .  	L NEAR	0000	CODE	External
PRTCHR . . . . . . . . . . . . .  	L NEAR	05DE	CODE	Global
PYA  . . . . . . . . . . . . . .  	L NEAR	0425	CODE
P_DAY  . . . . . . . . . . . . .  	L NEAR	048E	CODE
P_DSEP . . . . . . . . . . . . .  	L NEAR	043D	CODE
P_MON  . . . . . . . . . . . . .  	L NEAR	0476	CODE
P_MONTH_NAM  . . . . . . . . . .  	L NEAR	0447	CODE
P_TIME . . . . . . . . . . . . .  	L NEAR	04BB	CODE
P_YR . . . . . . . . . . . . . .  	L NEAR	04A1	CODE

RAW_CON_INPUT  . . . . . . . . .  	Number	0007	
RAW_CON_IO . . . . . . . . . . .  	Number	0006	
RDLOOP . . . . . . . . . . . . .  	L NEAR	02A0	CODE
RDOK . . . . . . . . . . . . . .  	L NEAR	02D9	CODE
RDSKERR  . . . . . . . . . . . .  	L NEAR	0000	CODE	External
READ . . . . . . . . . . . . . .  	Number	003F	
READ_ACCESS_DENIED . . . . . . .  	Alias	 ERROR_ACCESS_DENIED		
READ_INVALID_HANDLE  . . . . . .  	Alias	 ERROR_INVALID_HANDLE		
RENAME . . . . . . . . . . . . .  	Number	0056	
RENAME_ACCESS_DENIED . . . . . .  	Alias	 ERROR_ACCESS_DENIED		
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-12
                                                             

RENAME_FILE_NOT_FOUND  . . . . .  	Alias	 ERROR_FILE_NOT_FOUND		
RENAME_NOT_SAME_DEVICE . . . . .  	Alias	 ERROR_NOT_SAME_DEVICE		
REPORT . . . . . . . . . . . . .  	L NEAR	0000	CODE	External
RET$1  . . . . . . . . . . . . .  	L NEAR	05F9	CODE
RET1 . . . . . . . . . . . . . .  	L NEAR	0547	CODE
RET2 . . . . . . . . . . . . . .  	L NEAR	05E2	CODE
RET32  . . . . . . . . . . . . .  	L NEAR	0629	CODE
RMDIR  . . . . . . . . . . . . .  	Number	003A	
RMDIR_ACCESS_DENIED  . . . . . .  	Alias	 ERROR_ACCESS_DENIED		
RMDIR_CURRENT_DIRECTORY  . . . .  	Alias	 ERROR_CURRENT_DIRECTORY		
RMDIR_PATH_NOT_FOUND . . . . . .  	Alias	 ERROR_PATH_NOT_FOUND		
ROOTSTR  . . . . . . . . . . . .  	L BYTE 	007E	CONST
RPRI . . . . . . . . . . . . . .  	Number	0006	

SECBUF . . . . . . . . . . . . .  	L WORD 	002B	DATA	Global
SECONDPASS . . . . . . . . . . .  	L BYTE 	00B8	CONST	Global
SERVERCALL . . . . . . . . . . .  	Number	005D	
SETBLOCK . . . . . . . . . . . .  	Number	004A	
SETBLOCK_ARENA_TRASHED . . . . .  	Alias	 ERROR_ARENA_TRASHED		
SETBLOCK_INVALID_BLOCK . . . . .  	Alias	 ERROR_INVALID_BLOCK		
SETBLOCK_INVALID_FUNCTION  . . .  	Alias	 ERROR_INVALID_FUNCTION		
SETBLOCK_NOT_ENOUGH_MEMORY . . .  	Alias	 ERROR_NOT_ENOUGH_MEMORY		
SETDIRLP . . . . . . . . . . . .  	L NEAR	01DF	CODE
SETDPB . . . . . . . . . . . . .  	Number	0053	
SETDSK . . . . . . . . . . . . .  	L NEAR	01A8	CODE
SETSTACK . . . . . . . . . . . .  	L NEAR	0140	CODE
SETSWITCH  . . . . . . . . . . .  	L NEAR	0000	CODE	External
SET_CTRL_C_TRAPPING  . . . . . .  	Number	0033	
SET_CURRENT_PDB  . . . . . . . .  	Number	0050	
SET_DATE . . . . . . . . . . . .  	Number	002B	
SET_DEFAULT_DRIVE  . . . . . . .  	Number	000E	
SET_DMA  . . . . . . . . . . . .  	Number	001A	
SET_INTERRUPT_VECTOR . . . . . .  	Number	0025	
SET_OEM_HANDLER  . . . . . . . .  	Number	00F8	
SET_TIME . . . . . . . . . . . .  	Number	002D	
SET_VERIFY_ON_WRITE  . . . . . .  	Number	002E	
SF_DEFAULT_NUMBER  . . . . . . .  	Number	0005	
SKIPSPC  . . . . . . . . . . . .  	L NEAR	0633	CODE
SLASHOK  . . . . . . . . . . . .  	L NEAR	0177	CODE
SRFCBPT  . . . . . . . . . . . .  	L WORD 	0027	DATA	Global
SSIZE  . . . . . . . . . . . . .  	L WORD 	000E	DATA	Global
STACKLIM . . . . . . . . . . . .  	L WORD 	002E	DATA	Global
STACKOK  . . . . . . . . . . . .  	L NEAR	0144	CODE
STDAUX . . . . . . . . . . . . .  	Number	0003	
STDERR . . . . . . . . . . . . .  	Number	0002	
STDIN  . . . . . . . . . . . . .  	Number	0000	
STDOUT . . . . . . . . . . . . .  	Number	0001	
STDPRN . . . . . . . . . . . . .  	Number	0004	
STD_AUX_INPUT  . . . . . . . . .  	Number	0003	
STD_AUX_OUTPUT . . . . . . . . .  	Number	0004	
STD_CON_INPUT  . . . . . . . . .  	Number	0001	
STD_CON_INPUT_FLUSH  . . . . . .  	Number	000C	
STD_CON_INPUT_NO_ECHO  . . . . .  	Number	0008	
STD_CON_INPUT_STATUS . . . . . .  	Number	000B	
Microsoft (R) Macro Assembler  Version 4.00                 3/27/20 07:52:40

CHKDSK - MS-DOS Disk consistancy checker                    Symbols-13
                                                             

STD_CON_OUTPUT . . . . . . . . .  	Number	0002	
STD_CON_STRING_INPUT . . . . . .  	Number	000A	
STD_CON_STRING_OUTPUT  . . . . .  	Number	0009	
STD_PRINTER_OUTPUT . . . . . . .  	Number	0005	
SUBERRP  . . . . . . . . . . . .  	L NEAR	0613	CODE	Global
SWITCHAR . . . . . . . . . . . .  	L BYTE 	007D	CONST	Global

TCHAR  . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
THISDPB  . . . . . . . . . . . .  	L DWORD	0008	DATA	Global
TRUE . . . . . . . . . . . . . .  	Number	FFFF	

UNLINK . . . . . . . . . . . . .  	Number	0041	
UNLINK_ACCESS_DENIED . . . . . .  	Alias	 ERROR_ACCESS_DENIED		
UNLINK_FILE_NOT_FOUND  . . . . .  	Alias	 ERROR_FILE_NOT_FOUND		
UNPACK . . . . . . . . . . . . .  	L NEAR	0000	CODE	External
UNSCALE  . . . . . . . . . . . .  	L NEAR	0548	CODE
USERDEV  . . . . . . . . . . . .  	L BYTE 	000C	DATA	Global
USERDIR  . . . . . . . . . . . .  	L BYTE 	00BC	CONST	Global
USERIDOPER . . . . . . . . . . .  	Number	005E	
USPDAT . . . . . . . . . . . . .  	L NEAR	0410	CODE

VNAME  . . . . . . . . . . . . .  	V BYTE 	0000	CONST	External
VOLID  . . . . . . . . . . . . .  	L BYTE 	0000	CONST
VOLNAM . . . . . . . . . . . . .  	L BYTE 	0007	CONST

WAIT . . . . . . . . . . . . . .  	Number	004D	
WPRI . . . . . . . . . . . . . .  	Number	0008	
WRITE  . . . . . . . . . . . . .  	Number	0040	
WRITE_ACCESS_DENIED  . . . . . .  	Alias	 ERROR_ACCESS_DENIED		
WRITE_INVALID_HANDLE . . . . . .  	Alias	 ERROR_INVALID_HANDLE		

XDUP . . . . . . . . . . . . . .  	Number	0045	
XDUP2  . . . . . . . . . . . . .  	Number	0046	

ZEROTRUNC  . . . . . . . . . . .  	L BYTE 	0023	DATA	Global


   2137 Source  Lines
   2199 Total   Lines
    662 Symbols

  16880 Bytes symbol space free

      0 Warning Errors
      0 Severe  Errors
