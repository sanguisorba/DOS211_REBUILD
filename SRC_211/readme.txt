使用した環境
〇Neko Project 21/W
〇MS-DOS 5.0A
〇MASM 1.20
〇LINK 2.00 (MASM 1.20に付属のものですが、ディストリビューションディスクのものと同じです）
〇EXE2BIN　- 2.11のソースコードからコンパイルしたものを使用
〇MASM 5.1 付属のEXEMOD.EXE (SORT.EXEに適用させるため)

ソースコードは下記の修正に加えてMASM 1.20で吐けるように全て調整済なのでプルリクエストは1.20を持っている方のみ！


#ユーティリティ
以下のソースコードは基本的にどのMS-DOS 2.11でも起動します。FORMATとSYSはメーカーによるカスタマイズがあるため起動はしても動作しないことがあります。

###CHKDSK.COM 2.30 (動作○)
```
○ASM→OBJにする
CHKDSK.ASM (*要改変)
CHKMES.ASM
CHKPROC.ASM

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK CHKDSK.OBJ CHKPROC.OBJ CHKMES.OBJ
EXE2BIN CHKDSK.EXE CHKDSK.COM
```

CHKDSK.ASMはそのままコンパイルしようとするとエラーが起きるので次のように訂正する必要があります。

```
859行目
        XCHG    AL,[ERRSUB]
                ↓
        XCHG    AL,BYTE PTR [ERRSUB]
```

###DEBUG.COM 2.30 (動作○)
```
○ASM→OBJにする
DEBASM.ASM
DEBCOM1.ASM
DEBCOM2.ASM
DEBCONST.ASM
DEBDATA.ASM
DEBMES.ASM
DEBUASM.ASM
DEBUG.ASM

○ASM→OBJにしない
DEBEQU.ASM
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK DEBUG.OBJ DEBCOM1.OBJ DEBCOM2.OBJ DEBUASM.OBJ DEBASM.OBJ DEBCONST.OBJ DEBDATA.OBJ DEBMES.OBJ
EXE2BIN DEBUG.EXE DEBUG.COM
```

###DISKCOPY.COM 1.20 (動作○)
```
○ASM→OBJにする
DISKCOPY.ASM
DISKMES.ASM

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK DISKCOPY.OBJ DISKMES.OBJ
EXE2BIN DISKCOPY.EXE DISKCOPY.COM
```

###EDLIN.COM 2.14 (動作○)
```
○ASM→OBJにする
EDLIN.ASM
EDLMES.ASM
EDLPROC.ASM

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK EDLIN.OBJ EDLMES.OBJ EDLPROC.OBJ
EXE2BIN EDLIN.EXE EDLIN.COM
```

###EXE2BIN.EXE 2.00 (動作○)
```
○ASM→OBJにする
EXE2BIN.ASM
EXEMES.ASM

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK EXE2BIN.OBJ EXEMES.OBJ
```

###FC.EXE 1.00 (動作○)
```
○ASM→OBJにする
FC.ASM
FCMES.ASM

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK FC.OBJ FCMES.OBJ
```

###FIND.EXE 1.28 (動作○)
```
○ASM→OBJにする
FIND.ASM
FINDMES.ASM

LINK FIND.OBJ FINDMES.OBJ
```

###FORMAT.COM 2.10 (動作○)
```
○ASM→OBJにする
FORMAT.ASM
FORMES.ASM
GENFOR.ASM ←本来はメーカー毎に書くものらしい。これはマイクロソフトのサンプルコード。詳しくはFORMAT.DOCに記載

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK FORMAT.OBJ FORMES.OBJ GENFOR.OBJ
EXE2BIN FORMAT.EXE FORMAT.COM
```

###MORE.COM (動作○)
```
○ASM→OBJにする
MORE.ASM
MOREMES.ASM

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK MORE.OBJ MOREMES.OBJ
EXE2BIN MORE.EXE MORE.COM
```

###PRINT.COM 1.00 (動作○)
```
○ASM→OBJにする
PRINT.ASM ← 2.11を使う

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK PRINT.OBJ
EXE2BIN PRINT.EXE PRINT.COM
```

###RECOVER.COM 1.50 (起動○ 動作未確認)
```
○ASM→OBJにする
RECMES.ASM
RECOVER.ASM

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK RECOVER.OBJ RECMES.OBJ
EXE2BIN RECOVER.EXE RECOVER.COM
```

###SORT.EXE (動作○)
```
○ASM→OBJにする
SORT.ASM
SORTMES.ASM

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK SORT.OBJ SORTMES.OBJ

そのままではSORT終了後にフリーズする。
PCjsによればMASM付属のEXEMODを使わないとだめらしい。
EXEMODはMASM 5.1付属のものを使用した。

EXEMOD SORT.EXE /MAX 1 /MIN 1

適用後はちゃんと動くようになった。
```

###SYS.COM 1.81 (動作○)
```
○ASM→OBJにする
SYS.ASM
SYSMES.ASM

○ASM→OBJにしない
DOSMAC.ASM ← 2.11を使う
DOSSYM.ASM ← 2.11を使う

LINK SYS.OBJ SYSMES.OBJ
EXE2BIN SYS.EXE SYS.COM
```

#OS本体

###COMMAND.COM 2.11 (動作○)
```
○ASM→OBJにする
COMMAND.ASM
COPY.ASM
COPYPROC.ASM
CPARSE.ASM
INIT.ASM
RDATA.ASM
RUCODE.ASM
TCODE.ASM
TCODE2.ASM
TCODE3.ASM
TCODE4.ASM
TCODE5.ASM
TDATA.ASM (*破損)
TSPC.ASM
TUCODE.ASM
UINIT.ASM

○ASM→OBJにしない
COMEQU.ASM
COMSEG.ASM
COMSW.ASM (*要改変)
EXEC.ASM
IFEQU.ASM
DOSSYM.ASM ← 2.11を使う
DOSMAC.ASM ← 2.11を使う
DEVSYM.ASM
```
※リンカ用ファイルCOMLINKがある。

COMSWでIBM PC-DOSからMS-DOSへ切り替える必要があります。

TDATA.ASMは文字化けがあります。正しい内容はこちら

https://raw.githubusercontent.com/jeffpar/pcjs-demo-disks/master/pcx86/dos/microsoft/2.11/src/COMMAND/TDATA.ASM



###MSDOS.SYS or IBMDOS.COM (ファイル欠)
```
○ASM→OBJにする
MSDOS.ASM
MSCODE.ASM <-486行目 最後の '>' が一個多い
DOSMES.ASM
MISC.ASM <-432行目 ISSPECの名前でエラー有
GETSET.ASM
DIRCALL.ASM
ALLOC.ASM
DEV.ASM
DIR.ASM
DISK.ASM
FAT.ASM
ROM.ASM
STDBUF.ASM
STDCALL.ASM
STDCTRLC.ASM
STDFCB.ASM
STDPROC.ASM
STDIO.ASM <- IO.ASMがないのでオブジェクトファイルに吐き出せない
TIME.ASM
XENIX.ASM
XENIX2.ASM

○ASM→OBJにしない
BUF.ASM
CTRLC.ASM
DEVSYM.ASM
DOSMAC.ASM ← 2.11を使う
DOSSEG.ASM
DOSSYM.ASM ← 2.11を使う
EXEC.ASM
FCB.ASM
(IO.ASM) <-ない
MSDATA.ASM
MSHEAD.ASM
MSINIT.ASM
PROC.ASM
STDSW.ASM
(STRIN.ASM) <-本来はIO.ASMに呼び出される筈のスクリプトファイル
SYSCALL.ASM

LINK DOSLINK
EXE2BIN MSDOS.EXE MSDOS.SYS or IBMDOS.COM
```
※リンカ用ファイルDOSLINKがある。
John Elliott氏によるMSDOS.SYSの改良版アセンブリが存在し、代替が効きます。他の不具合も解消されています。
http://www.seasip.info/DOS/
STDSWでIBM PC-DOSからMS-DOSへ切り替える必要があります。

更にPCjsによる改良版があるためそちらを拝借してます。

###IO.SYS or IBMBIO.COM (ファイル欠)
```
○ASM→OBJにする
(BIOS.ASM) <-自分で書く。　サンプルコード SKELIO.ASM
SYSIMES.ASM
SYSINIT.ASM

LINK BIOS.OBJ SYSIMES.OBJ SYSINIT.OBJ
EXE2BIN BIOS.EXE IO.SYS or IBMBIO.COM
```

BIOS.ASMは自分で書けとREADMEに書いてあります。BIOS.ASMの例としてマイクロソフトはSKELIO.ASMというALTOS ACS-86C用のIO.SYSモジュールのアセンブリを付属しています。

ちなみにIBM PCDOS版のIBMBIO.COMとマイクロソフト版のIO.SYSのアセンブラに違いはありません。EXE2BINで.COMにするか.SYSにするかの違いだけです。
